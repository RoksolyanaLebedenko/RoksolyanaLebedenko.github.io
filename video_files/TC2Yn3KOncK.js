/*!CK:1433504829!*//*1447779185,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["YfOwR"]); }

__d('ChatFileUploader.react',['ChatFileUploaderMixin','InlineBlock.react','MercuryConfig','React','ReactDOM','cx','createCancelableFunction','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p=k.createClass({displayName:'ChatFileUploader',mixins:[h],getDefaultProps:function(){return {uploaderIsFromHigherLevel:true};},shouldComponentUpdate:function(){return false;},componentDidMount:function(){this._uploaderCallback=n(this.setUpSubscriptionsHandler);this.props.initFileUploaderFn(l.findDOMNode(this.refs.form),l.findDOMNode(this.refs.input),l.findDOMNode(this.refs.attachID)).then(this._uploaderCallback);},componentWillUnmount:function(){if(this._uploaderCallback)this._uploaderCallback.cancel();},render:function(){return (k.createElement('form',{ref:'form',action:j.upload_url,method:'post'},k.createElement('input',{type:'hidden',ref:'attachID',name:'attach_id'}),k.createElement(i,{className:"_m _4q60 itemLabel"},k.createElement('input',{type:'file',className:"_n",name:'attachment[]',multiple:'true',ref:'input'}),k.createElement('span',{className:"_4q61 itemAnchor"},o._("\u0414\u043e\u0434\u0430\u0442\u0438 \u0444\u0430\u0439\u043b\u0438...")))));}});f.exports=p;},null);
__d('NotificationSettingsDialog',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={show:function(i){e(['MercuryThreadActions'],function(j){j.get().openNotificationSettings(i);});}};f.exports=h;},null);
__d('ChatTabMenu.react',['AsyncDialog','AsyncRequest','Bootloader','ChatConfig','ChatFileUploader.react','ChatPrivacyActionController','ChatTabActions','Dialog','MercuryConfig','MercuryIDs','MercuryLogMessageType','MercuryMessengerBlockingUtils','MercuryParticipants','MercuryThreadMuter','MercuryViewer','MercurySourceType','NFXChatHeadGK','Promise','ReactComponentWithPureRenderMixin','React','PopoverMenu.react','ReactMenu','MenuSeparator.react','RTCConfig','Run','Toggler','TrackingNodes','URI','WebMessengerDeleteThreadDialog','WebMessengerThreadPermalinks','XNFXStartForMessageThreadController','WorkModeConfig','WorkFileUploadsGating','NotificationSettingsDialog','MessengerNotificationSettingsGKModule','cx','fbt','goURI','MercuryMessageObject','MercuryThreadIDMap','MercuryThreadActions','MercuryThreads','MercuryMessageActions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa){'use strict';if(c.__markCompiled)c.__markCompiled();var ta=c('MercuryMessageObject').get(),ua=c('MercuryThreadIDMap').get(),va=c('MercuryThreadActions').get(),wa=c('MercuryThreads').get(),xa=c('MercuryMessageActions').get(),ya=ca.Item,za=aa.PropTypes,ab=aa.createClass({displayName:'ChatTabMenu',_privacyActionController:undefined,_fileUploaderPromise:undefined,mixins:[z],propTypes:{attachmentsShelf:za.object,nameConversationFunc:za.func,isGroupChat:za.bool,isEmptyChat:za.bool,hasMessageBlocked:za.bool,hasSecretModeOn:za.bool,onFileUploaderMounted:za.func,onSubmit:za.func,onUpdateAttachmentsShelf:za.func,onUploadFinished:za.func,otherUserID:za.string,sheetController:za.object.isRequired,showAddFriend:za.func,threadID:za.string.isRequired},getInitialState:function(){return {url:null,privacyText:'',muted:false};},getDefaultProps:function(){return {show:true,isMuted:false,hasSwitchToWork:false};},componentDidMount:function(){ka.getThreadURI(this.props.threadID,(function(bb){this.isMounted()&&this.setState({url:bb});}).bind(this));if(!this.props.isGroupChat)this._privacyActionController=new m(q.getUserIDFromThreadID(this.props.threadID),(function(bb){return this._updatePrivacyLink(bb);}).bind(this));},componentDidUpdate:function(bb,cb){if(this.props.isMuted&&!bb.isMuted){this.props.sheetController.openThreadIsMutedTabSheet();}else if(!this.props.isMuted&&bb.isMuted)this.props.sheetController.closeThreadIsMutedTabSheet();if(this.props.hasMessageBlocked){this.props.sheetController.openMessageBlockedTabSheet();}else this.props.sheetController.closeMessageBlockedTabSheet();if(this.props.hasSecretModeOn){this.props.sheetController.openSecretModeSheet();}else this.props.sheetController.closeSecretModeSheet();},_initFileUploader:function(bb,cb,db){if(this._fileUploaderPromise){this._fileUploaderPromise.then(function(eb){eb.updateElements(bb,cb,db);});}else this._fileUploaderPromise=new y((function(eb,fb){fa.onAfterLoad((function(){j.loadModules(["MercuryFileUploader"],(function(gb){var hb=new gb(this.props.attachmentsShelf,bb,cb,db);eb(hb);}).bind(this));}).bind(this));}).bind(this));return this._fileUploaderPromise;},componentWillUnmount:function(){this._privacyActionController&&this._privacyActionController.destroy();this._fileUploaderPromise&&this._fileUploaderPromise.then(function(bb){bb.destroy();});},_unmuteThread:function(){va.unmute(this.props.threadID);ga.hide();},_togglePrivacyFunc:function(){this._privacyActionController&&this._privacyActionController.togglePrivacy();},_renderFileUploader:function(){return (aa.createElement(ya,{className:"_37_x"},aa.createElement(l,{onFileUploaderMounted:this.props.onFileUploaderMounted,attachmentsShelf:this.props.attachmentsShelf,initFileUploaderFn:this._initFileUploader,onUploadFinished:this.props.onUploadFinished,onUpdateAttachmentsShelf:this.props.onUpdateAttachmentsShelf,onSubmit:this.props.onSubmit})));},_renderOpenFullConversation:function(){if(this.state.url)return (aa.createElement(ya,{onclick:(function(){return sa(this.state.url);}).bind(this)},ra._("\u041f\u0440\u043e\u0433\u043b\u044f\u043d\u0443\u0442\u0438 \u0432\u0441\u044e \u0440\u043e\u0437\u043c\u043e\u0432\u0443")));return null;},_renderAddFriend:function(){if(!this.props.showAddFriend)return null;var bb=ma.is_work_user?ra._("Add coworkers to Chat..."):ra._("\u0414\u043e\u0434\u0430\u0442\u0438 \u0434\u0440\u0443\u0433\u0430 \u0434\u043e \u0447\u0430\u0442\u0443...");return (aa.createElement(ya,{onclick:this.props.showAddFriend},bb));},_renderTogglePrivacy:function(){if(!this.props.isGroupChat&&this.state.privacyText)return (aa.createElement(ya,{onclick:this._togglePrivacyFunc},this.state.privacyText));return null;},_renderNotificationSettings:function(){if(pa.inGK){var bb=oa.show.bind(null,this.props.threadID);return (aa.createElement(ya,{onclick:bb},ra._("\u041d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f \u0441\u043f\u043e\u0432\u0456\u0449\u0435\u043d\u044c...")));}return null;},_renderMuteConversation:function(){if(!this.props.isMuted){var bb=u.showMuteChangeDialog.bind(null,this.props.threadID,null);return (aa.createElement(ya,{onclick:bb},ra._("\u0412\u0438\u043c\u043a\u043d\u0443\u0442\u0438 \u0437\u0432\u0443\u043a \u0440\u043e\u0437\u043c\u043e\u0432\u0438")));}else return (aa.createElement(ya,{onclick:this._unmuteThread},ra._("\u0423\u0432\u0456\u043c\u043a\u043d\u0443\u0442\u0438 \u0440\u043e\u0437\u043c\u043e\u0432\u0443")));},_renderDeleteConversation:function(){return (aa.createElement(ya,{onclick:this._deleteConversation},ra._("\u0412\u0438\u0434\u0430\u043b\u0438\u0442\u0438 \u0440\u043e\u0437\u043c\u043e\u0432\u0443...")));},_renderReportSpam:function(){if(!this.props.isGroupChat)return (aa.createElement(ya,{onclick:this._reportSpamClicked},ra._("\u041f\u043e\u0432\u0456\u0434\u043e\u043c\u0438\u0442\u0438 \u043f\u0440\u043e \u0441\u043f\u0430\u043c \u0430\u0431\u043e \u0437\u043b\u043e\u0432\u0436\u0438\u0432\u0430\u043d\u043d\u044f...")));return null;},_blockMessagesItem:function(){if(!this.props.isGroupChat&&s.gk_result&&!this.props.hasMessageBlocked)return (aa.createElement(ya,{onclick:this._messageBlockedClicked},ra._("Block Messages...")));if(!this.props.isMultichat&&s.gk_result&&this.props.hasMessageBlocked)return (aa.createElement(ya,{onclick:this._messageUnblockedClicked},ra._("Unblock Messages...")));return null;},_renderCreateGroup:function(){if(this.props.isGroupChat)return (aa.createElement(ya,{onclick:this._createGroupClicked},ra._("\u0421\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u0433\u0440\u0443\u043f\u0443")));return null;},_renderCreateEvent:function(){if(this.props.isGroupChat&&k.get('events_group_chat_item_test'))return (aa.createElement(ya,{onclick:this._createEventClicked},ra._("Create Event")));return null;},_renderSwitchToWork:function(){if(this.props.hasSwitchToWork)return (aa.createElement(ya,{onclick:this._switchToWorkUserClicked},ra._("Move to Work Account")));return null;},_renderConversationName:function(){if(this.props.isGroupChat&&this.state.url)return (aa.createElement(ya,{onclick:this.props.nameConversationFunc},ra._("\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u043d\u0430\u0437\u0432\u0443 \u0431\u0435\u0441\u0456\u0434\u0438")));return null;},_renderLeaveConversation:function(){if(this.props.isGroupChat)return (aa.createElement(ya,{onclick:this._unsubscribeLinkClicked},ra._("\u0417\u0430\u043b\u0438\u0448\u0438\u0442\u0438 \u0440\u043e\u0437\u043c\u043e\u0432\u0443...")));return null;},_renderEnableDesktopNotifications:function(){if(p.DesktopNotificationsGK&&"Notification" in window&&window.Notification.permission!=="granted")return (aa.createElement(ya,{onclick:this._enableDesktopNotif},ra._("Enable Desktop Notifications")));return null;},_renderPeopleList:function(){if(this.props.isGroupChat&&this.state.url)return (aa.createElement(ya,{onclick:this._showParticipants},ra._("\u0417\u043c\u0456\u043d\u0438\u0442\u0438 \u0443\u0447\u0430\u0441\u043d\u0438\u043a\u0456\u0432...")));return null;},_renderToggleSecretMode:function(){if(!k.get('enable_secret_mode'))return null;if(this.props.hasSecretModeOn){return (aa.createElement(ya,{onclick:this._secretModeTurnOff},ra._("Turn off disappearing messages")));}else return (aa.createElement(ya,{onclick:this._secretModeTurnOn},ra._("Turn On Disappearing Messages")));},_renderShareScreenContent:function(){if(ea.CollaborationScreenSharingGK&&!this.props.isGroupChat)return (aa.createElement(ya,{onclick:this._shareScreenContentClicked},ra._("Share Screen Content...")));return null;},_shareScreenContentClicked:function(){j.loadModules(["FBRTCScreenSharingController"],(function(bb){var cb=q.getUserIDFromThreadID(this.props.threadID),db=new bb(parseInt(cb,10),null,true);db.initializeAsSender();db.toggleScreenSharing();}).bind(this));},render:function(){var bb=this._renderReportSpam(),cb=this._blockMessagesItem(),db=this._renderCreateGroup(),eb=this._renderCreateEvent(),fb=aa.createElement(ca,{className:"chatReact"+(!this.props.show?' '+"hidden_elem":'')},this._renderOpenFullConversation(),na.canUploadFiles?this._renderFileUploader():null,this._renderToggleSecretMode(),this._renderAddFriend(),this._renderShareScreenContent(),this._renderTogglePrivacy(),this._renderConversationName(),this._renderPeopleList(),aa.createElement(da,null),this._renderNotificationSettings(),this._renderSwitchToWork(),this._renderMuteConversation(),this._renderDeleteConversation(),this._renderLeaveConversation(),bb||cb?aa.createElement(da,null):null,cb,bb,db||eb?aa.createElement(da,null):null,db,eb,this._renderEnableDesktopNotifications()),gb=ra._("\u041d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f"),hb=ha.getTrackingInfo(ha.types.DROPDOWN_BUTTON);return (aa.createElement(ba,{menu:fb},aa.createElement('a',{'data-ft':hb,'data-hover':'tooltip','aria-label':gb,'data-tooltip-alignh':'center',className:"button"+(this.props.isEmptyChat?' '+"hidden_elem":'')})));},getFileUploaderPromise:function(){return this._fileUploaderPromise;},_updatePrivacyLink:function(bb){var cb;if(bb==m.OFFLINE){cb=ra._("\u0412\u0438\u0439\u0442\u0438 \u0432 \u043c\u0435\u0440\u0435\u0436\u0443");this.setState({privacyText:cb});return;}if(this.props.isGroupChat||this.props.otherUserID===undefined)return;var db='fbid:'.concat(this.props.otherUserID);t.get(db,(function(eb){if(!eb.is_friend){cb=null;}else if(bb==m.BLOCKED){cb=ra._("\u0423\u0432\u0456\u043c\u043a\u043d\u0443\u0442\u0438 \u0431\u0435\u0441\u0456\u0434\u0443 \u0434\u043b\u044f {name}",[ra.param('name',eb.short_name)]);}else cb=ra._("\u0412\u0438\u043c\u043a\u043d\u0443\u0442\u0438 \u0431\u0435\u0441\u0456\u0434\u0443 \u0437 {name}",[ra.param('name',eb.short_name)]);this.setState({privacyText:cb});}).bind(this));},_showParticipants:function(){ua.getServerIDFromClientID(this.props.threadID,function(bb){h.send(new i(new ia('/ajax/browser/dialog/multichat_members/').addQueryData({id:bb})));});},_unsubscribeLinkClicked:function(){var bb=[];bb.push({name:'unsubscribe',label:ra._("\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u0438 \u0431\u0435\u0441\u0456\u0434\u0443?"),handler:(function(){return this._unsubscribeToThread();}).bind(this)});bb.push(o.CANCEL);new o().setTitle(ra._("\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u0438 \u0431\u0435\u0441\u0456\u0434\u0443?")).setBody(ra._("\u0412\u0438 \u0431\u0456\u043b\u044c\u0448\u0435 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442\u0435 \u043e\u0442\u0440\u0438\u043c\u0443\u0432\u0430\u0442\u0438 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c \u0437 \u0446\u0456\u0454\u0457 \u0431\u0435\u0441\u0456\u0434\u0438. \u0406\u043d\u0448\u0456 \u0443\u0447\u0430\u0441\u043d\u0438\u043a\u0438 \u043f\u043e\u0431\u0430\u0447\u0430\u0442\u044c, \u0449\u043e \u0432\u0438 \u0437\u0430\u043b\u0438\u0448\u0438\u043b\u0438 \u0431\u0435\u0441\u0456\u0434\u0443.")).setButtons(bb).show();},_unsubscribeToThread:function(){if(!wa.isEmptyLocalThread(this.props.threadID)){var bb=ta.constructLogMessageObject(w.CHAT_WEB,this.props.threadID,r.UNSUBSCRIBE,{removed_participants:[v.getID()]});xa.send(bb);}n.closeTab(this.props.threadID,'unsubscribed');return true;},_deleteConversation:function(){ja.show(this.props.threadID);},_reportSpamClicked:function(){var bb=new ia('/ajax/chat/report.php').addQueryData({id:this.props.otherUserID}).addQueryData({src:'top_report_link'});if(x.result)bb=la.getURIBuilder().setString('thread_fbid',this.props.otherUserID).setEnum('location','www_chat_head').getURI();h.send(new i(bb));},_messageBlockedClicked:function(){va.blockMessages(this.props.threadID);},_messageUnblockedClicked:function(){va.unblockMessages(this.props.threadID);},_secretModeTurnOff:function(){va.turnOffSecretMode(this.props.threadID);},_secretModeTurnOn:function(){va.turnOnSecretMode(this.props.threadID);},_createGroupClicked:function(){wa.getThreadMeta(this.props.threadID,function(bb){if(!bb.is_canonical){var cb=new ia('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger_dock',parent_id:'0'}),db=bb.participants.map(function(eb){return q.getUserIDFromParticipantID(eb);}).filter(function(eb){return eb;});cb.addQueryData({members:db});if(bb.name)cb.addQueryData({name:bb.name});h.send(new i(cb));}});},_createEventClicked:function(){wa.getThreadMeta(this.props.threadID,function(bb){if(!bb.is_canonical){var cb=new ia('/ajax/plans/create/dialog.php'),db=bb.participants.map(function(eb){return q.getUserIDFromParticipantID(eb);}).filter(function(eb){return eb;});cb.addQueryData({invite_ids:db,group_chat:true});if(bb.name)cb.addQueryData({eventname:bb.name});h.send(new i(cb));}});},_switchToWorkUserClicked:function(){var bb=[];bb.push({name:'move',label:ra._("Move Conversation"),handler:(function(){return this._switchToWork();}).bind(this)});bb.push(o.CANCEL);new o().setTitle(ra._("Move Conversation to Work Account?")).setBody(ra._("Do you want to move this conversation so that it shows in your work account instead?")).setButtons(bb).show();},_switchToWork:function(){if(!wa.isEmptyLocalThread(this.props.threadID)){var bb=ta.constructLogMessageObject(w.CHAT_WEB,this.props.threadID,r.SWITCH_TO_WORK,{removed_participants:[v.getID()]});xa.send(bb);}n.closeTab(this.props.threadID,'unsubscribed');return true;},_enableDesktopNotif:function(){b.Notification.requestPermission();}});f.exports=ab;},null);