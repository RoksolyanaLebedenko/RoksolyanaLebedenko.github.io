/*!CK:3576061509!*//*1448177230,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["yXONu"]); }

__d('P2PUser',['immutable'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i,j;'use strict';i=babelHelpers.inherits(k,h.Record({id:'',name:'',full_name:'',profile_uri:''}));j=i&&i.prototype;function k(){i.apply(this,arguments);}f.exports=k;},null);
__d('P2PPaymentRequest',['P2PPaymentRequestStatus','P2PUser','immutable'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k,l;'use strict';var m=Math.round(Date.now()/1000);k=babelHelpers.inherits(n,j.Record({amount:'',amountWithSymbol:'',creationTime:m,currency:'',currentStatus:h.INITED,groupThreadFBID:'',id:'',memoText:'',requestee:{},requester:{},transferID:'',updatedTime:m}));l=k&&k.prototype;function n(){k.apply(this,arguments);}f.exports=n;},null);
__d('P2PPaymentRequestsStore',['P2PActionConstants','Arbiter','ChannelConstants','CurrentUser','EventEmitter','ImmutableObject','P2PActions','P2PAPI','P2PChannelType','P2PDispatcher','P2PPaymentRequest','P2PPaymentRequestStatus','immutable'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t,u;'use strict';var v=c('immutable').List,w=null,x=false,y=null,z=new v(),aa=false,ba=false;t=babelHelpers.inherits(ca,l);u=t&&t.prototype;function ca(){u.constructor.call(this);i.subscribe(j.getArbiterType(p.PAYMENT_REQUEST_STATUS_CHANGED),this.handleChannelPaymentRequestStatusChanged.bind(this));q.register(this.onEventDispatched.bind(this));}ca.prototype.onEventDispatched=function(da){var ea=da.data,fa=da.type;switch(fa){case h.PAYMENT_REQUEST_INITIATED:aa=true;y=null;this.emit('change');break;case h.PAYMENT_REQUEST_INITIATED_COMPLETE:aa=false;this.emit('change');break;case h.PAYMENT_REQUEST_CREATED:this.handlePaymentRequestCreated(ea);this.emit('change');break;case h.PAYMENT_REQUEST_CREATED_ERROR:y=new m(ea.error);this.emit('change');break;case h.PAYMENT_REQUEST_UPDATED:this.handlePaymentRequestUpdated(ea);this.emit('change');break;case h.PAYMENT_REQUEST_DECLINE_INITIATED:x=true;w=null;this.emit('change');break;case h.PAYMENT_REQUEST_DECLINED:x=false;w=null;this.handlePaymentRequestDeclined(ea);this.emit('change');break;case h.PAYMENT_REQUEST_DECLINE_ERROR:x=false;w=new m(ea.error);this.emit('change');break;case h.DIALOG_CLOSED:w=null;this.emit('change');break;case h.PENDING_PAYMENT_REQUESTS_FETCHED:this.handlePendingPaymentRequestsFetched(ea);this.emit('change');break;}};ca.prototype.handlePaymentRequestCreated=function(da){var ea=z.toArray();ea.push(new r(da));ea.sort(function(fa,ga){return fa.creationTime-ga.creationTime;});z=new v(ea);};ca.prototype.handlePaymentRequestUpdated=function(da){this.updateRequest(da.id,da);};ca.prototype.handlePaymentRequestDeclined=function(da){this.updateRequest(da,{currentStatus:s.DECLINED});};ca.prototype.handleChannelPaymentRequestStatusChanged=function(da,ea){var fa=ea.obj;n.paymentRequestUpdated(fa);};ca.prototype.handlePendingPaymentRequestsFetched=function(da){da=da.sort(function(ea,fa){return ea.creationTime-fa.creationTime;});da.forEach((function(ea,fa){var ga=new r(ea);if(this.getPaymentRequestByID(ea.id))z=z.set(fa,ga);z=z.push(ga);}).bind(this));};ca.prototype.isPaymentRequestInitiated=function(){return aa;};ca.prototype.isPaymentRequestDeclining=function(){return x;};ca.prototype.getPaymentRequestByID=function(da){return z.find(function(ea){return da===ea.id;});};ca.prototype.getPaymentRequestError=function(){return y;};ca.prototype.getPaymentRequestDeclineError=function(){return w;};ca.prototype.getPendingPaymentRequest=function(){if(!ba){ba=true;o.getPendingPaymentRequests();}return z.filter(function(da){return (da.requestee.id===k.getID()&&da.currentStatus===s.INITED);}).last();};ca.prototype.updateRequest=function(da,ea){z.forEach(function(fa,ga){if(da===fa.id)z=z.set(ga,fa.merge(fa,ea));});};ca.prototype.getPaymentRequests=function(){return z;};f.exports=new ca();},null);