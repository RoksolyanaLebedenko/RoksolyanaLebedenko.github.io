/*!CK:2691439446!*//*1448180854,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["oJyTM"]); }

__d("MercuryAudioType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={AudioClip:"fb_voice_message",VoiceMessageWithTranscript:"fb_voice_message_with_transcript"};},null,{});
__d("PageMessageEnumTag",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={FLAG:"flag",LOW_VALUE:"low_value",SPAM_SPOOFING:"spam_spoofing"};},null,{});
__d("PagesMessagingConst",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={LOAD_MESSAGE_THREAD_URI:"\/ajax\/pages\/messages\/load_message_thread.php",ASYNC_ENDPOINT:"\/ajax\/messaging\/async.php",UNANSWERED_FILTER:"unanswered"};},null,{});
__d("PhotoResizeModeConst",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CONTAIN:"s",COVER:"p"};},null,{});
__d("StoryAttachmentStyle",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={FALLBACK:"fallback",SHARE:"share",OG_COMPOSER_SIMPLE:"og_composer_simple",SPORTS_MATCHUP:"sports_matchup",SHARE_LARGE_IMAGE:"share_large_image",PHOTO:"photo",COVER_PHOTO:"cover_photo",ALBUM:"album",NEW_ALBUM:"new_album",COUPON:"coupon",QUESTION:"question",ANSWER:"answer",OPTION:"option",GALLERY:"gallery",STREAM_PUBLISH:"stream_publish",MUSIC_AGGREGATION:"music_aggregation",ITEM_LIST:"list",HIGH_SCORE:"high_score",SCORE_LEADERBOARD:"score_leaderboard",FRIEND_LIST:"friend_list",CHECKIN:"checkin",POPULAR_OBJECTS:"popular_objects",AVATAR_LIST:"avatar_list",AVATAR:"avatar",AVATAR_WITH_VIDEO:"avatar_with_video",EVENT:"event",MINUTIAE_EVENT:"minutiae_event",EXPERIENCE:"experience",LIFE_EVENT:"life_event",TRAVEL_SLIDESHOW_LIFE_EVENT:"travel_slideshow_life_event",GIFT:"gift",IMAGE_SHARE:"image_share",ANIMATED_IMAGE_SHARE:"animated_image_share",ANIMATED_IMAGE_AUTOPLAY:"animated_image_autoplay",ANIMATED_IMAGE_VIDEO:"animated_image_video",ANIMATED_IMAGE_VIDEO_AUTOPLAY:"animated_image_video_autoplay",NOTE:"note",TOPIC:"topic",FILE_UPLOAD:"file_upload",NOTIFICATION_TARGET:"notification_target",UNAVAILABLE:"unavailable",PAGE_RECOMMENDATION:"page_recommendation",PAGE_VIDEO_PLAYLIST:"page_video_playlist",VIDEO:"video",VIDEO_INLINE:"video_inline",VIDEO_AUTOPLAY:"video_autoplay",VIDEO_SHARE:"video_share",VIDEO_SHARE_HIGHLIGHTED:"video_share_highlighted",VIDEO_SHARE_YOUTUBE:"video_share_youtube",VIDEO_DIRECT_RESPONSE:"video_direct_response",VIDEO_DIRECT_RESPONSE_AUTOPLAY:"video_direct_response_autoplay",MAP:"map",OG_MAP:"og_map",PRODUCT:"product",EXTERNAL_PRODUCT:"external_product",FITNESS_COURSE:"fitness_course",APPLICATION:"application",STICKER:"sticker",EXTERNAL_OG_PRODUCT:"external_og_product",TRAVEL_LOG:"travel_log",MULTI_SHARE:"multi_share",MULTI_SHARE_NO_END_CARD:"multi_share_no_end_card",MULTI_SHARE_SEARCH_END_CARD:"multi_share_search_end_card",YEAR_IN_REVIEW:"year_in_review",AVATAR_LARGE_COVER:"avatar_large_cover",COMMERCE_PRODUCT_ITEM:"commerce_product_item",COMMERCE_STORE:"commerce_store",THIRD_PARTY_PHOTO:"third_party_photo",PROMPT:"prompt",BIRTHDAY:"birthday",DONATIONS_CAMPAIGN:"donations_campaign",DONATE_PROMPT:"donate_prompt",DISCUSSION_CONVERSATION:"discussion_conversation",DISCUSSION_COMMENT:"discussion_comment",GROUP_SELL_PRODUCT_ITEM:"group_sell_product_item",GROUP_SELL_PRODUCT_ITEM_MARK_AS_SOLD:"group_sell_mark_as_sold",GAMETIME:"gametime",GAMETIME_PLAY:"gametime_play",GROUP_REPORTED_POST_QUEUE:"group_reported_post_queue",GROUP_PENDING_POST_QUEUE:"group_pending_post_queue",GROUP_JOIN_REQUEST_QUEUE:"group_join_request_queue",GREETING_CARD:"greeting_card",LEAD_GEN:"lead_gen",ATTACHED_STORY:"attached_story",SOUVENIR:"souvenir",SLIDESHOW:"slideshow",ORION:"orion",ORION_REQUEST:"orion_request",INSTANT_ARTICLE:"instant_article",JOIN_TOPIC_CONVERSATION:"join_topic_conversation",MOMENTS_APP_INVITATION:"moments_app_invitation",MOMENTS_APP_PHOTO_REQUEST:"moments_app_photo_request",RIDE_ORDERED:"ride_ordered",RIDE_RECEIPT:"ride_receipt",BUSINESS_MESSAGE_ITEMS:"business_message_items",RETAIL_CANCELLATION:"retail_cancellation",RETAIL_PROMOTION:"retail_promotion",RETAIL_ITEM:"retail_item",RETAIL_NOW_IN_STOCK:"retail_now_in_stock",RETAIL_RECEIPT:"retail_receipt",RETAIL_SHIPMENT:"retail_shipment",RETAIL_SHIPMENT_FOR_SUPPORTED_CARRIER:"retail_shipment_for_supported_carrier",RETAIL_SHIPMENT_FOR_UNSUPPORTED_CARRIER:"retail_shipment_for_unsupported_carrier",RETAIL_SHIPMENT_TRACKING_EVENT:"retail_shipment_tracking_event",RETAIL_SHIPMENT_TRACKING_EVENT_ETA:"retail_shipment_tracking_event_eta",RETAIL_SHIPMENT_TRACKING_EVENT_IN_TRANSIT:"retail_shipment_tracking_event_in_transit",RETAIL_SHIPMENT_TRACKING_EVENT_OUT_FOR_DELIVERY:"retail_shipment_tracking_event_out_for_delivery",RETAIL_SHIPMENT_TRACKING_EVENT_DELAYED:"retail_shipment_tracking_event_delayed",RETAIL_SHIPMENT_TRACKING_EVENT_DELIVERED:"retail_shipment_tracking_event_delivered",SURVEY:"survey",MESSAGE_LOCATION:"message_location",JOB_OFFER:"job_offer",GROUP_ADD_MEMBERS:"group_add_memebers",RTC_CALL_LOG:"rtc_call_log",EVENT_CALENDAR:"event_calendar",FACEPILE:"facepile",ATTRIBUTED_SHARE:"attributed_share",VIDEO_CINEMAGRAPH:"video_cinemagraph",LOCAL_CONTEXT_SHARE:"local_context_share",H_SCROLL:"h_scroll",EGO_HSCROLL:"ego_hscroll",MEDIA_QUESTION:"media_question",RICH_MEDIA:"rich_media",SQUARE_IMAGE_SHARE:"square_image_share",RETAIL_AGENT_ITEM_SUGGESTION:"retail_agent_item_suggestion",RETAIL_AGENT_ITEM_RECEIPT:"retail_agent_item_receipt",NOTE_COMPOSED:"note_composed",AVATAR_WITH_BIRTHDAY:"avatar_with_birthday",AIRLINE_FLIGHT_RESCHEDULE_UPDATE_BUBBLE:"airline_flight_reschedule_update_bubble",AIRLINE_CONFIRMATION:"airline_confirmation",AIRLINE_CHECK_IN:"airline_check_in",AIRLINE_BOARDING_PASS:"airline_boarding_pass",AIRLINE_FLIGHT_RESCHEDULE_UPDATE:"airline_flight_reschedule_update",LIGHTBOX_VIDEO:"lightbox_video",GLOBALLY_DELETED_MESSAGE_PLACEHOLDER:"globally_deleted_message_placeholder",GENIE_MESSAGE:"genie_message",MOVIE_BOT_MOVIE_LIST:"movie_bot_movie_list",MOVIE_BOT_MOVIE_SHOWTIME_LIST:"movie_bot_movie_showtime_list",AVATAR_WITH_EGO_ACTION:"avatar_with_ego_action",EVENT_TICKET:"event_ticket",VERTICAL_ATTACHMENT_LIST:"vertical_attachment_list",INSTANT_ARTICLE_LEGACY:"instant_article_legacy",FUNDRAISER_PAGE:"fundraiser_page",FINANCIAL_BILL_PAYMENT_REQUEST:"financial_bill_payment_request",GOODWILL_THROWBACK_FRIENDVERSARY_POLAROIDS_CARD:"goodwill_throwback_friendversary_polaroids_card",SAHELI_IMAGE:"saheli_image",LARGE_IMAGE_LIKE:"large_image_like",ASK_FRIENDS:"ask_friends",CULTURAL_MOMENT:"cultural_moment",TELEPHONE_CALL_LOG:"telephone_call_log",SUPER_EMOJI:"super_emoji",BOOK:"book",SUBTOPIC_CUSTOMIZATION_QUESTION:"subtopic_customization_question",SUBTOPIC_CUSTOMIZATION_OPTION:"subtopic_customization_option",RESTAURANT:"restaurant",CONNECTION_QUESTION:"connection_question",CONNECTION_QUESTION_OPTION:"connection_question_option",PYMI_ITEM:"pymi_item",GOODWILL_THROWBACK_FRIENDVERSARY_COLLAGE_CARD:"goodwill_throwback_friendversary_collage_card",CITY:"city",AVATAR_WITH_SHARE:"avatar_with_share",LIGHTWEIGHT_PLACE:"lightweight_place",QUOTED_SHARE:"quoted_share",SMS_LOG:"sms_log",CENTERED_TEXT:"centered_text",GOODWILL_THROWBACK_FRIENDVERSARY_DATA_CARD:"goodwill_throwback_friendversary_data_card",GOODWILL_THROWBACK_FACEVERSARY_COLLAGE_CARD:"goodwill_throwback_faceversary_collage_card"};},null,{});
__d('ChatQuietLinks',['Event','DOM','UserAgent_DEPRECATED','DataStore','Parent'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m={},n={silenceLinks:function(r){o(r,this.removeEmptyHrefs.bind(this));},nukeLinks:function(r){o(r,this.removeAllHrefs.bind(this));},removeEmptyHrefs:function(r){p(r,function(s){return !s||s==='#';});},removeAllHrefs:function(r){p(r);}};function o(r,s){var t=!!j.chrome(),u=!!j.chrome()||j.ie()>=9||j.firefox()>=4;if(m[i.getID(r)])return;m[i.getID(r)]=true;if(!u)return;if(!t){s&&s(r);return;}h.listen(r,'mouseover',function v(w){var x=l.byTag(w.getTarget(),'a');if(x){var y=x.getAttribute('href');if(q(y)){k.set(x,'stashedHref',x.getAttribute('href'));x.removeAttribute('href');}}});h.listen(r,'mouseout',function v(w){var x=l.byTag(w.getTarget(),'a'),y=x&&k.remove(x,'stashedHref');if(q(y))x.setAttribute('href',y);});h.listen(r,'mousedown',function(v){if(!v.isDefaultRequested())return true;var w=l.byTag(v.getTarget(),'a'),x=w&&k.get(w,'stashedHref');if(q(x))w.setAttribute('href',x);});}function p(r,s){var t=i.scry(r,'a');if(s)t=t.filter(function(u){return s(u.getAttribute('href'));});t.forEach(function(u){u.removeAttribute('href');u.setAttribute('tabindex',0);});}function q(r){return r&&r!=='#';}f.exports=n;},null);
__d('PagesMessengerThreadUtils',['MessagingTag','PageMessageEnumTag'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={isFlagThread:function(k){if(k&&k.page_thread_info&&'flagged' in k.page_thread_info)return k.page_thread_info.flagged;return false;},isPageSpecficFilter:function(k){if(k===i.FLAG)return true;return false;},getBatchActionMenuParam:function(k){var l=false,m=false,n=false,o=false,p=false,q=false,r=false,s=false,t=false;if(k.folder===h.INBOX&&!k.is_archived){l=true;o=true;if(j.isFlagThread(k)){r=true;}else q=true;if(k&&k.unread_count===0){t=true;}else s=true;}else if(k.folder===h.SPAM){p=true;}else if(k.is_archived){m=true;n=true;}if(k&&k.unread_count===0){t=true;}else s=true;return {showArchive:l,showDelete:m,showUnarchive:n,showSpam:o,showUnspam:p,showFlag:q,showUnflag:r,showMarkRead:s,showMarkUnread:t,showHideContextCard:false,showShowContextCard:false};}};f.exports=j;},null);
__d('WebMessengerEvents',['Arbiter'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=Object.assign(new h(),{MASTER_DOM_CHANGED:'master-dom-changed',DETAIL_DOM_CHANGED:'detail-dom-changed',FOCUS_COMPOSER:'focus-composer',FOCUS_SEARCH:'focus-search',FOCUS_AND_SELECT_SEARCH:'focus-and-select-search',STICKER_CLICKED:'sticker-clicked',SUBMIT_REPLY:'submit-reply',UPDATE_SELECTION:'update-selection',masterDOMChanged:function(){this.inform(i.MASTER_DOM_CHANGED);},detailDOMChanged:function(){this.inform(i.DETAIL_DOM_CHANGED);},focusComposer:function(){this.inform(i.FOCUS_COMPOSER);},focusSearch:function(){this.inform(i.FOCUS_SEARCH);},focusAndSelectSearch:function(){this.inform(i.FOCUS_AND_SELECT_SEARCH);},updateSelection:function(j){this.inform(i.UPDATE_SELECTION,j);},stickerClicked:function(j,k){this.inform(i.STICKER_CLICKED,{packID:j,stickerID:k});},submitReply:function(){this.inform(i.SUBMIT_REPLY);}});f.exports=i;},null);
__d('WebMessengerSubscriptionsHandler',['SubscriptionsHandler'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=new h('webmessenger');f.exports=i;},null);
__d("isWebMessengerURI",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){return (/^(\/messages)/.test(i.getPath()));}f.exports=h;},null);
__d('WebMessengerWidthControl',['Arbiter','BlueBar','CSS','CSSClassTransition','DOMDimensions','Event','Style','URI','ViewportBounds','WebMessengerEvents','WebMessengerSubscriptionsHandler','$','cx','isWebMessengerURI','requestAnimationFrame','setTimeoutAcrossTransitions','shield','throttle'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){if(c.__markCompiled)c.__markCompiled();var z=205,aa=981,ba=257,ca=18,da=848,ea=724,fa=.57,ga=56,ha,ia,ja;function ka(pa,qa,ra){this.masterChanged=pa;this.detailChaned=qa;r.addSubscriptions(m.listen(window,'resize',y(x(la,this,this),100)),h.subscribe(['sidebar/initialized','sidebar/show','sidebar/hide','minisidebar/show'],x(la,this,this),h.SUBSCRIBE_NEW));var sa=oa()?ga:0;if(ra)sa=z;this._width=oa()?0:da;ja=true;la(this,sa);}function la(pa,qa){var ra=p.getRight()+p.getLeft();ra=ra||qa||0;var sa=l.getViewportWithoutScrollbarDimensions().width-ra,ta=Math.round(Math.max(0,sa/2-aa/2));sa=aa+ta-ba;sa-=ca;sa=Math.max(ea,Math.min(da,sa));if(!isNaN(sa)&&pa._width!==sa){pa._width=sa;var ua=Math.round(sa/(1+fa)),va=sa-ua;pa.masterChanged(va);pa.detailChaned(ua);if(oa()){var wa=sa+ba;ma(function(){if(ia){document.body.className=ia;ia='';}na(wa+'px');j.removeClass(document.body,"_5uj5");ja&&q.detailDOMChanged();ja=false;},ia);}}}function ma(pa,qa){qa&&j.addClass(document.documentElement,"_5uj6");v(pa);qa&&w(j.removeClass.bind(null,document.documentElement,"_5uj6"),1000);}function na(pa){n.set(i.getNavRoot(),'width',pa);n.set(s('globalContainer'),'width',pa);}function oa(){if(!ha)ha=j.hasClass(document.body,"_6nw");return ha;}k.registerHandler(function(pa,qa,ra,sa){function ta(ua){return oa()&&u(new o(ua));}if(ta(sa)){ia=qa;return true;}else if(ta(ra)){ma(function(){pa.className=qa;na('');},true);return true;}});f.exports=ka;},null);
__d('Dock',['Event','shield','Arbiter','ArbiterMixin','BlueBar','ChatQuietLinks','CSS','DataStore','DOM','Parent','Scroll','Style','Toggler','Vector','csx','emptyFunction','WebMessengerWidthControl'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){if(c.__markCompiled)c.__markCompiled();c('WebMessengerWidthControl');function x(){}Object.assign(x,k,{MIN_HEIGHT:140,INITIAL_FLYOUT_HEIGHT_OFFSET:10,init:function(y){this.init=w;this.rootEl=y;this.calculateViewportDimensions();this.calculateFlyoutHeightOffset();m.removeEmptyHrefs(this.rootEl);h.listen(y,'click',this._onClick.bind(this));h.listen(window,'resize',this._onWindowResize.bind(this));t.subscribe(['show','hide'],(function(z,aa){var ba=aa.getActive();if(!p.contains(y,ba))return;if(n.hasClass(ba,'fbNub')){this.notifyNub(ba,z);if(z==='show')this._resizeNubFlyout(ba);}else{var ca=q.byClass(ba,'fbNubFlyout');if(ca)n.conditionClass(ca,'menuOpened',z==='show');}}).bind(this));this.inform('init',{},j.BEHAVIOR_PERSISTENT);},calculateViewportDimensions:function(){return this.viewportDimensions=u.getViewportDimensions();},calculateFlyoutHeightOffset:function(){this.flyoutHeightOffset=this.INITIAL_FLYOUT_HEIGHT_OFFSET+u.getElementDimensions(this.rootEl).y;var y=l.getBar();if(y){var z=s.isFixed(y)?'viewport':'document';this.flyoutHeightOffset+=u.getElementPosition(y,z).y+u.getElementDimensions(y).y;}},toggle:function(y){var z=this._findFlyout(y);if(!z)return;this.subscribe('init',function(){t.toggle(y);});},show:function(y){this.subscribe('init',function(){t.show(y);});},showNub:function(y){n.show(y);},hide:function(y){this.subscribe('init',function(){var z=t.getInstance(y);p.contains(y,z.getActive())&&z.hide();});},hideNub:function(y){n.hide(y);this.hide(y);},setUseMaxHeight:function(y,z){n.conditionClass(y,'maxHeight',z!==false);this._resizeNubFlyout(y);},_resizeNubFlyout:function(y){var z=this._findFlyout(y);if(!z||n.hasClass(y,'placeholder')||!(n.hasClass(y,'openToggler')||n.hasClass(y,'opened')))return;var aa=p.find(z,'div.fbNubFlyoutOuter'),ba=p.find(aa,'div.fbNubFlyoutInner'),ca=p.find(ba,'div.fbNubFlyoutBody'),da=r.getTop(ca),ea=ca.offsetHeight;s.set(ca,'height','auto');var fa=u.getElementDimensions(z),ga=u.getElementDimensions(ca),ha=this.getMaxFlyoutHeight(y);s.set(z,'max-height',ha+'px');s.set(aa,'max-height',ha+'px');fa=u.getElementDimensions(z);var ia=u.getElementDimensions(ba),ja=ia.y-ga.y,ka=fa.y-ja,la=parseInt(ca.style.height||ca.clientHeight,10),ma=ka!==la;if(fa.y>ja&&ma)s.set(ca,'height',ka+'px');n.removeClass(z,'swapDirection');var na=u.getElementPosition(z).x;n.conditionClass(z,'swapDirection',(function(){if(na<0)return true;return na+fa.x>this.viewportDimensions.x;}).bind(this)());if(ma&&da+ea>=ga.y){r.setTop(ca,ca.scrollHeight);}else r.setTop(ca,da);this.notifyNub(y,'resize');},getMaxFlyoutHeight:function(y){var z=this._findFlyout(y),aa=u.getElementPosition(z,'viewport'),ba=u.getElementDimensions(z),ca=Math.max(this.MIN_HEIGHT,this.viewportDimensions.y-this.flyoutHeightOffset)-(this.viewportDimensions.y-aa.y-ba.y);return Math.max(ca,0);},resizeAllFlyouts:function(){var y=this._getAllNubs(),z=y.length;while(z--)this._resizeNubFlyout(y[z]);},hideAllFlyouts:function(){var y=this._getAllNubs(),z=y.length;while(z--)this.hide(y[z]);},_getAllNubs:function(){var y=p.scry(this.rootEl,"div._50-v.openToggler");return y.concat(p.scry(this.rootEl,"div._50-v.opened"));},_onClick:function(event){var y=event.getTarget(),z=q.byClass(y,'fbNub');if(z){if(q.byClass(y,'fbNubFlyoutTitlebar')){var aa=q.byTag(y,'a'),ba=y.nodeName=='INPUT'&&y.getAttribute('type')=='submit';if(!aa&&!ba){this.hide(z);return false;}}this.notifyNub(z,'click');}},_onWindowResize:function(event){this.calculateViewportDimensions();this.resizeAllFlyouts();},_findFlyout:function(y){return n.hasClass(y,'fbNubFlyout')?y:p.scry(y,'div.fbNubFlyout')[0]||null;},registerNubController:function(y,z){o.set(y,'dock:nub:controller',z);z.subscribe('nub/button/content-changed',i(this.inform,this,'resize',y));z.subscribe('nub/flyout/content-changed',i(this._resizeNubFlyout,this,y));},unregisterNubController:function(y){o.remove(y,'dock:nub:controller');},notifyNub:function(y,z,aa){var ba=o.get(y,'dock:nub:controller');ba&&ba.inform(z,aa);}});f.exports=b.Dock||x;},null);
__d('PureStoreBasedStateMixin',['StoreBasedStateMixinHelper','invariant','setImmediate'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=(function(){for(var l=arguments.length,m=Array(l),n=0;n<l;n++)m[n]=arguments[n];return {getInitialState:function(){return this.constructor.calculateState();},componentWillMount:function(){!this.constructor.calculateState?i(0):undefined;this._recalculateStateID=null;var o=(function(){if(this.isMounted())this.setState(this.constructor.calculateState());this._recalculateStateID=null;}).bind(this);this._mixin=new h(m);this._mixin.subscribeCallback((function(){if(this._recalculateStateID===null)this._recalculateStateID=j(o);}).bind(this));},componentWillUnmount:function(){this._mixin.release();this._mixin=null;}};}).bind(this);f.exports=k;},null);
__d('mergeDeepInto',['invariant','mergeHelpers'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=i.ArrayStrategies,k=i.checkArrayStrategy,l=i.checkMergeArrayArgs,m=i.checkMergeLevel,n=i.checkMergeObjectArgs,o=i.isTerminal,p=i.normalizeMergeArg,q=function(u,v,w,x){n(u,v);m(x);var y=v?Object.keys(v):[];for(var z=0;z<y.length;z++){var aa=y[z];s(u,v,aa,w,x);}},r=function(u,v,w,x){l(u,v);m(x);var y=Math.max(u.length,v.length);for(var z=0;z<y;z++)s(u,v,z,w,x);},s=function(u,v,w,x,y){var z=v[w],aa=v.hasOwnProperty(w),ba=aa&&o(z),ca=aa&&Array.isArray(z),da=aa&&!ca&&!ca,ea=u[w],fa=u.hasOwnProperty(w),ga=fa&&o(ea),ha=fa&&Array.isArray(ea),ia=fa&&!ha&&!ha;if(ga){if(ba){u[w]=z;}else if(ca){u[w]=[];r(u[w],z,x,y+1);}else if(da){u[w]={};q(u[w],z,x,y+1);}else if(!aa)u[w]=ea;}else if(ha){if(ba){u[w]=z;}else if(ca){!j[x]?h(0):undefined;if(x===j.Clobber)ea.length=0;r(ea,z,x,y+1);}else if(da){u[w]={};q(u[w],z,x,y+1);}else !aa;}else if(ia){if(ba){u[w]=z;}else if(ca){u[w]=[];r(u[w],z,x,y+1);}else if(da){q(ea,z,x,y+1);}else !aa;}else if(!fa)if(ba){u[w]=z;}else if(ca){u[w]=[];r(u[w],z,x,y+1);}else if(da){u[w]={};q(u[w],z,x,y+1);}else !aa;},t=function(u,v,w){var x=p(v);k(w);q(u,x,w,0);};f.exports=t;},null);
__d('mergeDeep',['mergeHelpers','mergeDeepInto'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=h.checkArrayStrategy,k=h.checkMergeObjectArgs,l=h.normalizeMergeArg,m=function(n,o,p){var q=l(n),r=l(o);k(q,r);j(p);var s={};i(s,q,p);i(s,r,p);return s;};f.exports=m;},null);
__d('ReactComponentRenderer',['React','ReactDOM','Object.assign','warning'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();function l(m,n){this.klass=m;this.container=n;this.props={};this.component=null;}l.prototype.replaceProps=function(m,n){this.props={};this.setProps(m,n);};l.prototype.setProps=function(m,n){if(this.klass==null)return;j(this.props,m);var o=h.createElement(this.klass,this.props);this.component=i.render(o,this.container,n);};l.prototype.unmount=function(){i.unmountComponentAtNode(this.container);this.klass=null;};f.exports=l;},null);
__d('DropdownContextualHelpLink',['DOM','ge'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={set:function(k){var l=i('navHelpCenter');if(l!==null)h.replace(l,k);}};f.exports=j;},null);
__d('MercuryGroupThreadMentions',['CurrentUser','ShortProfiles'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={messageMentionsViewer:function(k,l){i.get(h.getID(),function(m){l(new RegExp('@'+m.firstName,'i').test(k.body));});}};f.exports=j;},null);
__d('MercuryThreadInfo',['CurrentUser','MercuryIDs'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j={canReply:function(l){return !!(l.is_subscribed&&(l.can_reply===undefined||l.can_reply)&&!l.has_email_participant&&!l.read_only&&(l.recipients_loadable||l.recipients_loadable===undefined));},getMuteSetting:function(l){return (l.mute_settings&&l.mute_settings[k(h.getID())]);},isEmptyLocalThread:function(l){return (i.tokenize(l.thread_id).type==='root'&&!l.timestamp);},isMuted:function(l){return j.getMuteSetting(l)!==undefined;},isNewEmptyLocalThread:function(l){return !!(j.isEmptyLocalThread(l)&&l.participants&&l.participants.length===0);},showComposer:function(l){return !!(l.is_subscribed&&(l.composer_enabled===undefined||l.composer_enabled)&&!l.has_email_participant&&!l.read_only&&(l.recipients_loadable||l.recipients_loadable===undefined));}};function k(l){return l+'@facebook.com';}f.exports=j;},null);
__d('MercuryServerRequestSingletonMixin',['CurrentUser','FBID'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={_getInstances:function(){if(!this._instances)this._instances={};return this._instances;},get:function(){return this.getForFBID(h.getID());},getForFBID:function(k){var l=this._getInstances();if(!l[k])if(i.isUser(k)){l[k]=new this(k);}else{var m;e(['MercuryPageServerRequests'],function(n){m=new n(k);});l[k]=m;}return l[k];}};f.exports=j;},null);
__d('MercuryAssert',['MercuryIDs'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();f.exports={isParticipantID:function(i){if(!h.isValid(i))throw 'bad_participant_id '+i;},allParticipantIDs:function(i){i.forEach(this.isParticipantID);},isUserParticipantID:function(i){var j=h.tokenize(i);if(j.type!='fbid')throw 'bad_user_id '+i;},isEmailParticipantID:function(i){var j=h.tokenize(i);if(j.type!='email')throw 'bad_email_id '+i;},allThreadID:function(i){i.forEach(this.isThreadID);},isThreadID:function(i){if(!h.isValid(i))throw 'bad_thread_id '+i;}};},null);
__d('MercuryPageServerRequests',['MercuryAPIArgsSource','MercuryAssert','MercuryServerRequests','PageMessageEnumTag','PagesMessengerThreadUtils','MercuryServerDispatcher'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n,o,p=h.MERCURY;n=babelHelpers.inherits(q,j);o=n&&n.prototype;function q(r){'use strict';o.constructor.call(this,r);var s={'/pages/messaging/thread_tag/add/':{request_user_id:r,mode:m.BATCH_SUCCESSIVE,batch_function:this.$MercuryPageServerRequests1,handler:(function(t,u){return this.__handleUpdate(t,u);}).bind(this)},'/pages/messaging/thread_tag/remove/':{request_user_id:r,mode:m.BATCH_SUCCESSIVE,batch_function:this.$MercuryPageServerRequests1,handler:(function(t,u){return this.__handleUpdate(t,u);}).bind(this)},'/pages/messaging/thread_tag/list/':{request_user_id:r,mode:m.IMMEDIATE,handler:(function(t,u){return this.__handleUpdate(t,u);}).bind(this)},'/pages/messaging/create_note/':{request_user_id:r,mode:m.IMMEDIATE,handler:(function(t,u){return this.__handleUpdate(t,u);}).bind(this)}};m.registerEndpoints(s);}q.prototype.$MercuryPageServerRequests1=function(r,s){'use strict';var t=r?r.tag_name:s.tag_name,u=r?r.thread_ids:[],v=s?s.thread_ids:[],w=u.concat(v),x={tag_name:t,thread_ids:w};return x;};q.prototype.addThreadFlag=function(r,s){'use strict';i.isThreadID(r);this.__threadIDMap.getServerIDFromClientID(r,(function(t){var u={thread_ids:[t],tag_name:k.FLAG};this.__sendRequest('/pages/messaging/thread_tag/add/',u);}).bind(this));};q.prototype.createNote=function(r,s,t){'use strict';i.isThreadID(t);this.__threadIDMap.getServerIDFromClientID(t,(function(u){var v={body:r,message_id:s,other_user_fbid:u};this.__sendRequest('/pages/messaging/create_note/',v);}).bind(this));};q.prototype.fetchThreadlistInfo=function(r,s,t,u,v){'use strict';if(l.isPageSpecficFilter(u)){v=v||p;var w={folder:t,tag_name:u,offset:r,limit:s};this.__sendRequest('/pages/messaging/thread_tag/list/',w);return;}o.fetchThreadlistInfo.call(this,r,s,t,u,v);};q.prototype.removeThreadFlag=function(r,s){'use strict';i.isThreadID(r);this.__threadIDMap.getServerIDFromClientID(r,(function(t){var u={thread_ids:[t],tag_name:k.FLAG};this.__sendRequest('/pages/messaging/thread_tag/remove/',u);}).bind(this));};q.prototype.toString=function(){'use strict';return 'MercuryPageServerRequests';};f.exports=q;},null);
__d('MercuryAttachment',['MercuryAttachmentContentType','MercuryAttachmentType','MercuryAudioType','cx'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l={getAttachIconClass:function(m){switch(m){case h.PHOTO:return "_y2-";case h.VIDEO:return "_y2_";case h.MUSIC:return "_y30";case h.VOICE:return "_y31";case h.TEXT:return "_y32";case h.MSWORD:return "_y33";case h.MSXLS:return "_y34";case h.MSPPT:return "_y35";}return "_y36";},getAttachIconClassByMime:function(m){if(m.startsWith('image')){return "_y2-";}else if(m.startsWith('video')){return "_y2_";}else if(m.startsWith('audio')){return "_y30";}else if(m.startsWith('text/plain')){return "_y32";}else return "_y36";},getAttachTypeByMime:function(m){if(m.startsWith('image')){return h.PHOTO;}else if(m.startsWith('video')){return h.VIDEO;}else if(m.startsWith('audio')){return h.MUSIC;}else if(m.startsWith('text/plain')){return h.TEXT;}else return h.UNKNOWN;},convertRaw:function(m){var n=[];for(var o=0;o<m.length;o++){var p=m[o];if(p.attach_type===i.PHOTO){n.push(p);}else if(p.filename){var q=l.getAttachTypeByMime(p.filetype),r={};r.attach_type=i.FILE;r.name=p.filename;r.icon_type=q;r.url='';n.push(r);}}return n;},get:function(m){var n=[];if(m.attachments){n=m.attachments;}else if(m.raw_attachments)n=this.convertRaw(m.raw_attachments);if(!(m.attachments&&m.attachments.length>0)){if(m.sticker_id)return n.concat([{attach_type:i.STICKER}]);if(m.preview_attachments&&m.preview_attachments.length>0)return n.concat(m.preview_attachments);}return n;},resizeContain:function(m,n){var o=m.width/m.height,p=n.width/n.height;if(p<o){return {width:Math.ceil(Math.min(m.height*p,n.width)),height:Math.ceil(Math.min(m.height,n.height))};}else return {width:Math.ceil(Math.min(m.width,n.width)),height:Math.ceil(Math.min(m.width/p,n.height))};},isBubblePreferred:function(m){return !(this.isPhotoAttachment(m)||this.isStickerAttachment(m)||this.isVideoAttachment(m)||this.isVoiceAttachment(m));},isEphemeralAttachmentStyle:function(m){return (this.isPhotoAttachment(m)||this.isVideoAttachment(m));},isEphemeralTextStyle:function(m){return (this.isErrorAttachment(m)||this.isShareAttachment(m)||this.isFileAttachment(m));},isPhotoAttachment:function(m){return !!(m.attach_type==i.PHOTO||m.attach_type==i.ANIMATED_IMAGE||m.attach_type==i.FILE&&m.preview_url);},isVideoAttachment:function(m){return m.attach_type==i.VIDEO;},isShareAttachment:function(m){return m.attach_type==i.SHARE;},isFileAttachment:function(m){return m.attach_type==i.FILE;},isErrorAttachment:function(m){return m.attach_type==i.ERROR;},isStickerAttachment:function(m){return m.attach_type==i.STICKER;},isVoiceAttachment:function(m){if(!m.metadata)return false;return (m.metadata.type===j.AudioClip||m.metadata.type===j.VoiceMessageWithTranscript);},hasAttribution:function(m){return !!m.app_attribution;}};f.exports=l;},null);
__d('MercurySingletonProvider',['CurrentUser','Map'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();function j(k){this.$MercurySingletonProvider1=new i();this.$MercurySingletonProvider2=k;}j.prototype.getForFBID=function(k){if(!this.$MercurySingletonProvider1.has(k))this.$MercurySingletonProvider1.set(k,new this.$MercurySingletonProvider2(k));return this.$MercurySingletonProvider1.get(k);};j.prototype.get=function(){return this.getForFBID(h.getID());};j.mock=function(k){throw new Error('MercurySingletonProvider.mock() must only be used in tests.');};f.exports=j;},null);
__d('MercurySingletonMixin',['CurrentUser'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={_getInstances:function(){if(!this._instances)this._instances={};return this._instances;},get:function(){return this.getForFBID(h.getID());},getForFBID:function(j){var k=this._getInstances();if(!k[j])k[j]=new this(j);return k[j];}};f.exports=i;},null);
__d('MercuryThreadInformer',['ArbiterMixin','LogHistory','MercuryAssert','MercuryLoggingHelper','MercurySingletonMixin','mapObject','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o,p;'use strict';var q=i.getInstance('mercury_informer');o=babelHelpers.inherits(r,n(h));p=o&&o.prototype;function r(t){p.constructor.call(this);this.$MercuryThreadInformer1=t;this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4={};this.$MercuryThreadInformer5=false;this.$MercuryThreadInformer6=false;this.$MercuryThreadInformer7=false;this.$MercuryThreadInformer8={};this.$MercuryThreadInformer9={};this.$MercuryThreadInformer10={};this.$MercuryThreadInformer11=0;}r.prototype.updatedThread=function(t){this.$MercuryThreadInformer3[t]=true;this.$MercuryThreadInformer12();};r.prototype.deletedThread=function(t){this.$MercuryThreadInformer2[t]=true;this.$MercuryThreadInformer12();};r.prototype.updatedThreadlist=function(){this.$MercuryThreadInformer5=true;this.$MercuryThreadInformer12();};r.prototype.updatedUnseenState=function(){this.$MercuryThreadInformer6=true;this.$MercuryThreadInformer12();};r.prototype.updatedUnreadState=function(){this.$MercuryThreadInformer7=true;this.$MercuryThreadInformer12();};r.prototype.changedThreadReadState=function(t,u,v){if(!this.$MercuryThreadInformer4[t]||this.$MercuryThreadInformer4[t].timestamp<v)this.$MercuryThreadInformer4[t]={mark_as_read:u,timestamp:v};this.$MercuryThreadInformer12();};r.prototype.receivedMessage=function(t){j.isThreadID(t.thread_id);var u=t.thread_id;if(!this.$MercuryThreadInformer8[u])this.$MercuryThreadInformer8[u]=[];this.$MercuryThreadInformer8[u].push(t);this.updatedThread(u);};r.prototype.reorderedMessages=function(t,u){this.$MercuryThreadInformer9[t]={source:u};this.$MercuryThreadInformer12();};r.prototype.updatedMessage=function(t,u,v){if(!this.$MercuryThreadInformer10[t])this.$MercuryThreadInformer10[t]={};this.$MercuryThreadInformer10[t][u]={source:v};this.updatedThread(t);};r.prototype.synchronizeInforms=function(t){this.$MercuryThreadInformer11++;try{t();}catch(u){throw u;}finally{this.$MercuryThreadInformer11--;this.$MercuryThreadInformer12();}};r.prototype.listen=function(t,u){return this.subscribe('threads-updated',function(v,w){if(w[t])u(t);});};r.prototype.$MercuryThreadInformer12=function(){if(!this.$MercuryThreadInformer11){var t=this.$MercuryThreadInformer2,u=this.$MercuryThreadInformer3,v=this.$MercuryThreadInformer4,w=this.$MercuryThreadInformer5,x=this.$MercuryThreadInformer6,y=this.$MercuryThreadInformer7,z=this.$MercuryThreadInformer8,aa=this.$MercuryThreadInformer9,ba=this.$MercuryThreadInformer10;this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4={};this.$MercuryThreadInformer5=false;this.$MercuryThreadInformer6=false;this.$MercuryThreadInformer7=false;this.$MercuryThreadInformer8={};this.$MercuryThreadInformer9={};this.$MercuryThreadInformer10={};var ca=Object.keys(u);if(ca.length||w)this.inform('threadlist-updated',ca);if(ca.length)this.$MercuryThreadInformer13('threads-updated',u);for(var da in v){this.$MercuryThreadInformer13('thread-read-changed',v);break;}for(da in t){this.$MercuryThreadInformer13('threads-deleted',t);break;}if(x)this.$MercuryThreadInformer13('unseen-updated',null);if(y)this.$MercuryThreadInformer13('unread-updated',null);for(da in z){this.$MercuryThreadInformer13('messages-received',z);break;}for(da in aa){this.$MercuryThreadInformer13('messages-reordered',aa);break;}for(da in ba){this.$MercuryThreadInformer13('messages-updated',ba);break;}}};r.prototype.$MercuryThreadInformer13=function(t,u){s(t,u);this.inform(t,u);};function s(t,u){var v=u;if(t=='messages-received')v=m(v,function(w){return w.map(function(x){return k.obfuscateMessage(x);});});q.debug(t,v);}Object.assign(r,l);f.exports=r;},null);
__d('MercuryDispatcher',['ArbiterMixin','LogHistory','MercuryLoggingHelper','MercuryPayloadSource','MercurySingletonProvider','MercuryThreadInformer','invariant','isEmpty','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q,r;'use strict';var s=i.getInstance('mercury_dispatcher');q=babelHelpers.inherits(t,p(h));r=q&&q.prototype;t.getForFBID=function(v){return u.getForFBID(v);};t.get=function(){return u.get();};function t(v){r.constructor.call(this);this.$MercuryDispatcher1=v;}t.prototype.handleUpdate=function(v){this.$MercuryDispatcher2(v);!(!!v.from_client!==!!v.preprocessed)?n(0):undefined;delete v.preprocessed;if(!o(v))m.getForFBID(this.$MercuryDispatcher1).synchronizeInforms((function(){if(v.payload_source===k.SERVER_INVALIDATE_THREAD_STATE){var w=v.threads&&v.threads.length>0&&v.threads[0]&&v.threads[0].thread_id;if(w)this.inform('invalidate-thread-state',w);}if(!v.from_client)this.inform('payload-preprocessed',v);this.inform('update-thread-ids',v.newlyAddedClientIDs||{});this.inform('update-participants',v);this.inform('update-threads',v);this.inform('update-unread',v);this.inform('update-threadlist',v);this.inform('update-pinned-threads',v);this.inform('update-messages',v);this.inform('update-unseen',v);this.inform('update-typing-state',v);this.inform('update-delivery',v);this.inform('update-roger',v.roger);this.inform('update-blocked-users',v);this.inform('model-update-completed',null);}).bind(this));};t.prototype.$MercuryDispatcher2=function(v){var w={actions:[],threads:[]};if(v){if(v.actions)w.actions=v.actions.map(function(z){return j.obfuscateMessage(z);});if(v.threads)w.threads=v.threads.map(function(z){return j.obfuscateThread(z);});}var x=Object.assign({},v,w),y=v.payload_source;if(y!==k.CLIENT_CHANGE_READ_STATUS&&y!==k.CLIENT_MARK_THREAD_SEEN)s.debug('update:'+y,{payload:x,from_client:v.from_client});};var u=new l(t);f.exports=t;},null);
__d('MercurySendErrorLogger',['Banzai','BanzaiLogger'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=i.create({retry:true}),k=h.isEnabled('mercury_send_error_logging'),l={log:function(m){if(!k)return;var n={message_id:m.message_id,timestamp_client:Date.now(),error_type:m.error_data.type,error_code:m.error_data.code,error_description:m.error_data.description,is_transient:m.error_data.is_transient};j.log('MercurySendErrorLoggerConfig',n);}};f.exports=l;},null);
__d('MercuryServerPayloadPreprocessor',['CurrentEnvironment','MercuryIDs','MercuryConfig','MercuryActionStatus','MercuryActionType','MercuryAttachment','MercuryDispatcher','MercurySendErrorLogger','MercurySingletonMixin','MercuryThreadIDMap','StoryAttachmentStyle','invariant','URI'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){'use strict';if(c.__markCompiled)c.__markCompiled();function u(v){this.$MercuryServerPayloadPreprocessor1=v;this.$MercuryServerPayloadPreprocessor2=q.getForFBID(this.$MercuryServerPayloadPreprocessor1);this.$MercuryServerPayloadPreprocessor3=n.getForFBID(this.$MercuryServerPayloadPreprocessor1);}u.prototype.handleUpdate=function(v){var w={};!!v.from_client?s(0):undefined;(v.threads||[]).forEach((function(oa){this.$MercuryServerPayloadPreprocessor4(oa,w);var pa=this.$MercuryServerPayloadPreprocessor2.getServerIDFromClientIDNow(oa.thread_id);e(['MercuryServerRequests'],(function(qa){var ra=qa.getForFBID(this.$MercuryServerPayloadPreprocessor1);ra.markThreadFetched(oa.thread_id);ra.markThreadFetched(pa);ra.updateLastActionTimestamp(oa.timestamp);}).bind(this));}).bind(this));(v.ordered_threadlists||[]).forEach((function(oa){var pa=oa.thread_fbids||[];pa=pa.concat(oa.other_user_fbids||[]);oa.thread_ids=pa.map((function(qa){return this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(qa.toString());}).bind(this));}).bind(this));if(v.pinned_threads&&v.pinned_threads.thread_fbids)v.pinned_threads.thread_fbids=v.pinned_threads.thread_fbids.map((function(oa){return this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(oa);}).bind(this));if(v.delivery_receipts){var x={};for(var y=v.delivery_receipts,z=Array.isArray(y),aa=0,y=z?y:y[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ba;if(z){if(aa>=y.length)break;ba=y[aa++];}else{aa=y.next();if(aa.done)break;ba=aa.value;}var ca=ba,da=ca.other_user_fbid?i.getThreadIDFromUserID(ca.other_user_fbid):this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(ca.thread_fbid);x[da]=ca.time;}v.delivery_receipts=x;}v.actions=v.actions||[];v.actions.forEach((function(oa){if(oa.action_type===l.SEND_MESSAGE&&oa.status===k.ERROR)o.log(oa);var pa=null,qa=null;if(oa.other_user_fbid){qa=i.getThreadIDFromUserID(oa.other_user_fbid);pa=oa.other_user_fbid;}else if(oa.thread_fbid){qa=i.getThreadIDFromThreadFBID(oa.thread_fbid);pa=oa.thread_fbid;}else if(oa.thread_id){qa=i.getThreadIDFromThreadFBID(oa.thread_id);pa=oa.thread_id;}else if(oa.status&&oa.status!=k.SUCCESS&&oa.client_thread_id){qa=oa.client_thread_id;}else s(0);pa=pa&&pa.toString();oa.thread_id=this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(pa)?this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(pa):qa;if(oa.action_type==l.SEND_MESSAGE&&oa.client_thread_id&&pa){oa.thread_id=oa.client_thread_id;this.$MercuryServerPayloadPreprocessor2.forceSetServerIDToClientID(pa,oa.client_thread_id);w[pa]=oa.client_thread_id;}!oa.thread_id?s(0):undefined;if(!v.payload_source||!v.payload_source.startsWith('server'))e(['MercuryServerRequests'],(function(ra){ra.getForFBID(this.$MercuryServerPayloadPreprocessor1).updateLastActionTimestamp(oa.timestamp);}).bind(this));}).bind(this));this.$MercuryServerPayloadPreprocessor5(v);this.$MercuryServerPayloadPreprocessor6(v);if(v.end_of_history){var ea=[];for(var fa=0;fa<v.end_of_history.length;fa++){var ga=v.end_of_history[fa];if(ga.type=='user'){ea.push('user:'+ga.fbid);}else if(ga.type=='thread'&&this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(ga.fbid))ea.push(this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(ga.fbid));}v.end_of_history=ea;}if(v.roger){var ha={};for(var ia in v.roger){var ja=Object.keys(v.roger[ia]),ka;if(ia){ka=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(ia);}else if(ja.length===1)ka=i.getThreadIDFromUserID(ja[0]);if(ka){var la=v.roger[ia];ha[ka]={};for(var ma in la)if(la.hasOwnProperty(ma)){var na=i.getParticipantIDFromUserID(ma);ha[ka][na]=la[ma];}}}v.roger=ha;}v.newlyAddedClientIDs=w;v.preprocessed=true;this.$MercuryServerPayloadPreprocessor3.handleUpdate(v);};u.prototype.$MercuryServerPayloadPreprocessor4=function(v,w){var x=v.other_user_fbid?v.other_user_fbid:v.thread_fbid;!x?s(0):undefined;var y=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(x);if(!y){y=v.other_user_fbid?i.getThreadIDFromUserID(v.other_user_fbid):i.getThreadIDFromThreadFBID(v.thread_fbid);this.$MercuryServerPayloadPreprocessor2.setServerIDToClientID(x,y);this.$MercuryServerPayloadPreprocessor2.setDeprecatedServerIDToClientID(v.thread_id,y);w[x]=y;}v.thread_id=y;};u.prototype.$MercuryServerPayloadPreprocessor5=function(v){v.actions.forEach(function(w){if(w.action_type===l.USER_GENERATED_MESSAGE){w.attachments=w.attachments||[];w.attachments.forEach(function(x){if(m.isShareAttachment(x)&&h.messengerdotcom){var y=new t(x.share.uri);if(!y.getDomain())x.share.uri=y.setDomain('facebook.com').setSubdomain(t.getRequestURI().getSubdomain()).setProtocol('https').toString();}});}});};u.prototype.$MercuryServerPayloadPreprocessor6=function(v){if(!j.MercuryGenieRendering)return;v.actions.forEach(function(w){if(w.action_type!==l.USER_GENERATED_MESSAGE)return;var x=w;if(!x.has_attachment||!x.attachments)return;for(var y=x.attachments.length-1;y>=0;y-=1){var z=x.attachments[y];if(!z.share||!z.share.style_list||z.share.style_list[0]!=r.GENIE_MESSAGE)continue;if(z.share.target.genie_id)x.author=i.getParticipantIDFromUserID(z.share.target.genie_id);if(z.share.target&&!z.share.target.attachment){x.attachments.splice(y,1);x.has_attachment=x.attachments.length>0;}}});};Object.assign(u,p);f.exports=u;},null);
__d('MercuryMessageClientState',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={DO_NOT_SEND_TO_SERVER:'do_not_send_to_server',SEND_TO_SERVER:'send_to_server'};f.exports=h;},null);
__d('MercuryServerSendMessageQueueSimulatedError',['AsyncRequest','AsyncResponse'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=9999,k={create:function(l){var m=new h(this.endpoint_uri).setData({message_batch:[l],client:this.client}),n=new i(m,{});Object.assign(n,{error:j,silentError:false,transientError:true,request:m});return n;}};f.exports=k;},null);
__d('MercuryServerSendMessageQueue',['BanzaiODS','LogHistory','MercuryLoggingHelper','MercuryServerRequestsConfig','MercuryServerDispatcher','MercuryServerSendMessageQueueSimulatedError'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n='/ajax/mercury/send_messages.php',o=i.getInstance('mercury_server_send_message_queue');function p(q,r,s,t){'use strict';this.sender_id=q;this.queue_id=r;this.$MercuryServerSendMessageQueue1=s.success_handler;this.$MercuryServerSendMessageQueue2=s.error_handler;this.$MercuryServerSendMessageQueue3=s.transport_error_handler;this.$MercuryServerSendMessageQueue4=s.timeout_handler;this.client=t;var u=null;if(k.msgrRegion)u={name:'X-MSGR-Region',value:k.msgrRegion};var v={};v[n]={request_user_id:this.sender_id,endpoint_id:this.queue_id,mode:l.IMMEDIATE,customHeader:u,handler:this.handleSuccess.bind(this),error_handler:this.handleError.bind(this),transport_error_handler:this.handleTransportError.bind(this),timeout:s.timeout,timeout_handler:this.handleTimeout.bind(this),connection_retries:s.connection_retries};l.registerEndpoints(v);this.pending_message=null;this.queue=[];}p.prototype.enqueue=function(q){'use strict';this.queue.push(q);this.$MercuryServerSendMessageQueue5();};p.prototype.$MercuryServerSendMessageQueue5=function(){'use strict';if(this.pending_message||!this.queue.length){if(this.pending_message)this.$MercuryServerSendMessageQueue6();return;}this.pending_message=this.queue.shift();l.trySend(n,{message_batch:[this.pending_message],client:this.client},null,this.sender_id,this.queue_id);};p.prototype.$MercuryServerSendMessageQueue7=function(){'use strict';while(this.queue.length)this.$MercuryServerSendMessageQueue8(this.queue.shift());};p.prototype.$MercuryServerSendMessageQueue8=function(q){'use strict';this.$MercuryServerSendMessageQueue2(m.create(q));o.error('mark_as_failed',{fbid:this.sender_id,queue_id:this.queue_id,message:j.obfuscateMessage(q)});};p.prototype.handleSuccess=function(q,r){'use strict';this.$MercuryServerSendMessageQueue1(q,r);this.pending_message=null;this.$MercuryServerSendMessageQueue5();};p.prototype.handleError=function(q){'use strict';this.$MercuryServerSendMessageQueue2(q);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};p.prototype.handleTransportError=function(q){'use strict';this.$MercuryServerSendMessageQueue3(q);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};p.prototype.handleTimeout=function(q){'use strict';this.$MercuryServerSendMessageQueue4(q);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};p.prototype.$MercuryServerSendMessageQueue6=function(){'use strict';o.debug('maybe_send_next_pending_message',{fbid:this.sender_id,queue_id:this.queue_id,pending_message:j.obfuscateMessage(this.pending_message),queue:this.queue.map(function(r){return j.obfuscateMessage(r);})});var q='send_queue.delayed.queue_length.'+this.queue.length.toString();h.bumpEntityKey('chat.web',q);};f.exports=p;},null);
__d('MercuryServerSendMessageQueueRouter',['BanzaiODS','LogHistory','Map','MercuryServerSendMessageQueue','MercurySingletonMixin'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=i.getInstance('mercury_server_send_message_queue_router'),n='chat.web.send_queue_router';h.setEntitySample(n,.1);function o(p){'use strict';this.fbid=p;this.queues=new j();}o.prototype.enqueue=function(p,q,r,s){'use strict';if(!this.queues.has(p)){this.queues.set(p,new k(this.fbid,p,q,r));m.debug('added queue',{fbid:this.fbid,queue_id:p});h.bumpEntityKey(n,'new_queue');}this.queues.get(p).enqueue(s);};Object.assign(o,l);f.exports=o;},null);
__d('MercuryMessageIDs',['KeyedCallbackManager'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=new h(),j={getServerIDs:function(k,l){var m=k.filter(function(o){return o.indexOf('id')===-1;}),n=function(o){var p=k.map(function(q){return o[q]?o[q]:q;});l(p);};return i.executeOrEnqueue(m,n);},addServerID:function(k,l){i.setResource(k,l);}};f.exports=j;},null);
__d("MercuryServerSendMessageQueueOptions",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k,l,m,n){"use strict";this.success_handler=i;this.error_handler=j;this.transport_error_handler=k;this.timeout_handler=l;this.timeout=m;this.connection_retries=n;}f.exports=h;},null);
__d('MercuryServerRequests',['Arbiter','AsyncResponse','BanzaiODS','ChannelConstants','CurrentUser','LogHistory','MercuryActionStatus','MercuryActionType','MercuryAPIArgsSource','MercuryAssert','MercuryDispatcher','MercuryThreadIDMap','MercuryErrorType','MercuryGlobalActionType','MercuryIDs','MercuryLogMessageType','MercuryMessageClientState','MercuryPayloadSource','MercurySendErrorLogger','MercuryServerPayloadPreprocessor','MercuryServerRequestsConfig','MercuryServerSendMessageQueueRouter','MercuryServerRequestSingletonMixin','MercurySourceType','MercuryThreadlistConstants','MercuryMessageIDs','MessagingConfig','MessagingTag','MercuryServerDispatcher','MercuryServerSendMessageQueueOptions','createObjectFrom','errorCode','invariant','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa){'use strict';if(c.__markCompiled)c.__markCompiled();var pa=m.getInstance('mercury_server'),qa=p.MERCURY,ra=1000;function sa(db){return db.getError()?'_'+db.getError():'';}function ta(db,eb){var fb=babelHelpers._extends({},db),gb;if(eb.threads){if(!fb.threads)fb.threads={};for(gb in eb.threads)fb.threads[gb]=Object.keys(la((fb.threads[gb]||[]).concat(eb.threads[gb])));}if(eb.messages){if(!fb.messages)fb.messages={};for(gb in eb.messages){if(!fb.messages[gb])fb.messages[gb]={};for(var hb in eb.messages[gb])if(fb.messages[gb][hb]){fb.messages[gb][hb]=ya(fb.messages[gb][hb],eb.messages[gb][hb]);}else fb.messages[gb][hb]=eb.messages[gb][hb];}}fb.client=db.client||eb.client;return fb;}function ua(db,eb){var fb=Object.assign(la(db.folders,true),la(eb.folders,true)),gb=db.client||eb.client;return {folders:Object.keys(fb),client:gb};}function va(db,eb){for(var fb in eb)if(db[fb]&&typeof db[fb]==='object'){db[fb]=ya(db[fb],eb[fb]);}else if(eb[fb]&&typeof eb[fb]==='object'){var gb={};Object.assign(gb,eb[fb]);db[fb]=gb;}return db;}function wa(db,eb){var fb=babelHelpers._extends({},db.ids,eb.ids),gb=db.client||eb.client;return {ids:fb,client:gb};}function xa(db,eb){return eb;}function ya(db,eb){var fb=db.offset<eb.offset?db.offset:eb.offset,gb=db.offset+db.limit,hb=eb.offset+eb.limit,ib=gb>hb?gb:hb,jb=ib-fb,kb=db.timestamp>eb.timestamp?db.timestamp:eb.timestamp;return {offset:fb,limit:jb,timestamp:kb};}function za(db,eb){var fb=db.client||eb.client,gb={ids:{},client:fb};Object.assign(gb.ids,db.ids,eb.ids);return gb;}function ab(db,eb){var fb={},gb,hb=db.client||eb.client;delete db.client;delete eb.client;for(gb in db)Object.assign(fb,la(db[gb],gb));for(gb in eb)Object.assign(fb,la(eb[gb],gb));var ib={client:hb};for(var jb in fb){gb=fb[jb];if(!ib[gb])ib[gb]=[];ib[gb].push(jb);}return ib;}function bb(db,eb){var fb=db.client||eb.client,gb=la(db.ids,true),hb=la(eb.ids,true),ib=Object.assign(gb,hb);return {ids:Object.keys(ib),client:fb};}function cb(db){this._fbid=db;this._lastActionTimestamp=0;this._fetchingThreads={};this._sentMessagesTimestamp={};this.__threadIDMap=s.getForFBID(this._fbid);this._dispatcher=r.getForFBID(this._fbid);this._payloadPreprocessor=aa.getForFBID(this._fbid);this._sendMessageQueueOptions=new ka((function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this),(function(eb){return this._handleSendMessageError(eb);}).bind(this),(function(eb){return this._handleSendMessageTransportError(eb);}).bind(this),(function(eb){return this._handleSendMessageTimeout(eb);}).bind(this),ba.sendMessageTimeout,ha.SEND_CONNECTION_RETRIES);this._registerEndpoints();}Object.assign(cb.prototype,{fetchThreadlistInfo:function(db,eb,fb,gb,hb){fb=fb||ia.INBOX;hb=hb||qa;var ib=gb?ja.IMMEDIATE:null,jb={client:hb};jb[fb]={offset:db,limit:eb,filter:gb};this.__sendRequest('/ajax/mercury/threadlist_info.php',jb,ib);},fetchPinnedThreads:function(){this.__sendRequest('/mercury/pinned_threads/',{});},fetchUnseenThreadIDs:function(db,eb){eb=eb||qa;this.fetchThreadlistInfo(fa.RECENT_THREAD_OFFSET,fa.JEWEL_THREAD_COUNT,db,null,eb);},fetchUnreadThreadIDs:function(db,eb){eb=eb||qa;this.__sendRequest('/ajax/mercury/unread_threads.php',{folders:[db],client:eb});},fetchMissedMessages:function(db,eb,fb){eb=eb||qa;var gb={last_action_timestamp:fb||this._lastActionTimestamp,folders:db,client:eb};setTimeout((function(){this.__sendRequest('/ajax/mercury/thread_sync.php',gb);}).bind(this),ra);},fetchThreadData:function(db,eb){eb=eb||qa;q.allThreadID(db);var fb={threads:{},client:eb},gb=[],hb=[];db.forEach((function(jb){if(this._fetchingThreads[jb])return;this._fetchingThreads[jb]=true;var kb=this.__threadIDMap.getServerIDFromClientIDNow(jb),lb=v.tokenize(jb);if(lb.type=='user'){gb.push(lb.value);fb.threads.user_ids=gb;}else if(lb.type=='thread'){if(kb){hb.push(kb);}else hb.push(lb.value);fb.threads.thread_fbids=hb;}else if(lb.type=='root'){if(kb){hb.push(kb);fb.threads.thread_fbids=hb;}}else if(lb.type!='pending')throw new Error('Unknown thread type',lb);}).bind(this));this._dispatcher.inform("fetch-thread-data",fb);for(var ib in fb.threads){this.__sendRequest('/ajax/mercury/thread_info.php',fb);break;}},ensureThreadIsFetched:function(db,eb){eb=eb||qa;if(!this.__threadIDMap.getClientIDFromServerIDNow(db)&&!this._fetchingThreads[db]){this._fetchingThreads[db]=true;this.__sendRequest('/ajax/mercury/thread_info.php',{threads:{thread_fbids:[db]},client:eb});}},fetchThreadMessages:function(db,eb,fb,gb,hb,ib){q.isThreadID(db);ib=ib||qa;var jb,kb,lb=v.tokenize(db),mb=this.__threadIDMap.getServerIDFromClientIDNow(db),nb=false;if(mb){jb=mb;kb=lb.type=='user'?'user_ids':'thread_fbids';}else{jb=lb.value;switch(lb.type){case 'user':kb='user_ids';nb=true;break;case 'thread':kb='thread_fbids';break;}}var ob={messages:{},threads:{},client:ib};if(kb){ob.messages[kb]={};ob.messages[kb][jb]={offset:eb,timestamp:gb,limit:fb};if(nb)ob.threads[kb]=[jb];this.__sendRequest('/ajax/mercury/thread_info.php',ob,hb);}else this.__threadIDMap.getServerIDFromClientID(db,(function(pb){ob.messages.thread_fbids={};ob.messages.thread_fbids[pb]={offset:eb,timestamp:gb,limit:fb};this.__sendRequest('/ajax/mercury/thread_info.php',ob,hb);}).bind(this));},handleThreadInfoError:function(db){var eb=db.getRequest().getData(),fb=[];if(eb.messages){for(var gb in eb.messages.thread_fbids)fb.push(this._createServerErrorLogMessage(this.__threadIDMap.getClientIDFromServerIDNow(gb)));for(var hb in eb.messages.user_ids)fb.push(this._createServerErrorLogMessage('user:'+hb));for(var ib in eb.messages.group_ids)fb.push(this._createServerErrorLogMessage('group:'+ib));}if(fb.length)this._dispatcher.handleUpdate({actions:fb,from_client:true,payload_source:y.CLIENT_CHANNEL_MESSAGE});if(eb.threads&&(eb.threads.user_ids||eb.threads.group_ids||eb.threads.thread_ids)){var jb=5,kb=true;if(!eb.retry_count){eb.retry_count=0;if(eb.messages)delete eb.messages;}else if(eb.retry_count>=jb){kb=false;(eb.threads.thread_ids||[]).forEach((function(mb){if(mb in this._fetchingThreads)delete this._fetchingThreads[mb];}).bind(this));}if(kb){var lb=Math.pow(2,eb.retry_count)*1000;oa((function(){pa.log('retry_thread',eb);this.__sendRequest('/ajax/mercury/thread_info.php',eb);}).bind(this),lb);eb.retry_count++;}}},markFolderAsRead:function(db){this.__sendRequest('/ajax/mercury/mark_folder_as_read.php',{folder:db});var eb=[{action_type:u.MARK_ALL_READ,action_id:null,folder:db}];this._dispatcher.handleUpdate({global_actions:eb,from_client:true,payload_source:y.CLIENT_CHANGE_READ_STATUS});},changeThreadReadStatus:function(db,eb,fb,gb,hb,ib){q.isThreadID(db);this.__threadIDMap.getServerIDFromClientID(db,(function(jb){var kb,lb={ids:(kb={},kb[jb]=eb,kb),source:fb,watermarkTimestamp:gb,titanOriginatedThreadId:hb,shouldSendReadReceipt:ib};this.__sendRequest('/ajax/mercury/change_read_status.php',lb);}).bind(this));},changeThreadArchivedStatus:function(db,eb,fb){q.isThreadID(db);this.__threadIDMap.getServerIDFromClientID(db,(function(gb){var hb={ids:{},source:fb};hb.ids[gb]=eb;this.__sendRequest('/ajax/mercury/change_archived_status.php',hb);}).bind(this));},changeThreadFolder:function(db,eb){q.isThreadID(db);this.__threadIDMap.getServerIDFromClientID(db,(function(fb){var gb={};gb[eb]=[fb];this.__sendRequest('/ajax/mercury/move_thread.php',gb);}).bind(this));},changeMutingOnThread:function(db,eb){q.isThreadID(db);this.__threadIDMap.getServerIDFromClientID(db,(function(fb){this.__sendRequest('/ajax/mercury/change_mute_thread.php',{thread_fbid:fb,mute_settings:eb,payload_source:qa});}).bind(this));},markThreadSpam:function(db,eb){q.isThreadID(db);this.__threadIDMap.getServerIDFromClientID(db,(function(fb){this.__sendRequest('/ajax/mercury/mark_spam.php',{id:fb,source:eb});}).bind(this));},unmarkThreadSpam:function(db,eb){q.isThreadID(db);this.__threadIDMap.getServerIDFromClientID(db,(function(fb){this.__sendRequest('/ajax/mercury/unmark_spam.php',{id:fb,source:eb});}).bind(this));},deleteThread:function(db,eb){q.isThreadID(db);this.__threadIDMap.getServerIDFromClientID(db,(function(fb){var gb={ids:[fb],source:eb};this.__sendRequest('/ajax/mercury/delete_thread.php',gb);}).bind(this));},unpinThread:function(db){q.isThreadID(db);this.__threadIDMap.getServerIDFromClientID(db,(function(eb){this.__sendRequest('/mercury/unpin_thread/',{id:eb});}).bind(this));},deleteMessages:function(db,eb){ga.getServerIDs(eb||[],(function(fb){this.__sendRequest('/ajax/mercury/delete_messages.php',{message_ids:fb});}).bind(this));},sendDeliveryReceipts:function(db,eb){ga.getServerIDs(db||[],(function(fb){this.__sendRequest('/ajax/mercury/delivery_receipts.php',{message_ids:fb,thread_ids:eb});}).bind(this));},sendNewMessage:function(db,eb){eb=eb||qa;if(!db.offline_threading_id)j.bumpEntityKey('chat.web','missing_otid_on_send');if(db.client_state&&db.client_state!==x.SEND_TO_SERVER)return;var fb=v.tokenize(db.thread_id),gb=fb.type,hb=babelHelpers._extends({},db);hb.thread_id=null;if(gb=='user'){hb.other_user_fbid=fb.value;this._sendNewMessageToServer(hb,eb);}else if(gb=='thread'){hb.thread_fbid=fb.value;this._sendNewMessageToServer(hb,eb);}else if(gb=='root'&&fb.value==hb.offline_threading_id){hb.client_thread_id=db.thread_id;this._sendNewMessageToServer(hb,eb);}else{!v.isLocalThread(db.thread_id)?na(0):undefined;this.__threadIDMap.getServerIDFromClientID(db.thread_id,(function(ib){hb.thread_fbid=ib;this._sendNewMessageToServer(hb,eb);}).bind(this));}},_sendNewMessageToServer:function(db,eb){h.inform(k.ATTEMPT_RECONNECT);this._sentMessagesTimestamp[db.message_id]=Date.now();ca.getForFBID(this._fbid).enqueue(db.other_user_fbid||db.thread_fbid||db.client_thread_id,this._sendMessageQueueOptions,eb,db);},markSeen:function(){var db=this._lastActionTimestamp;this.__sendRequest('/ajax/mercury/mark_seen.php',{seen_timestamp:db});},_handleSendMessageErrorCommon:function(db,eb,fb,gb){pa.debug('handle_send_message_error_common',{reliability_error_status:fb,request_error_status:eb});var hb=db.getData(),ib=hb.message_batch,jb=ib.map(function(lb){var mb={action_type:o.SEND_MESSAGE,other_user_fbid:lb.other_user_fbid,thread_fbid:lb.thread_fbid,client_message_id:lb.message_id,message_id:lb.message_id,client_thread_id:lb.client_thread_id,status:eb,error_data:gb};return mb;});jb.forEach(function(lb){if(lb.action_type===o.SEND_MESSAGE&&lb.status===n.ERROR)z.log(lb);},this);var kb={actions:jb,payload_source:y.CLIENT_HANDLE_ERROR};this._payloadPreprocessor.handleUpdate(kb);},handleSendMessageError:function(db){var eb=db.getPayload(),fb=null,gb=null;if(eb&&eb.error_payload){fb=n.UNCONFIRMED;gb='send_error';}else{fb=n.ERROR;gb='request_error'+sa(db);}var hb=db.error;if(hb===1404102)i.verboseErrorHandler(db);var ib=/<.*>/.test(db.getErrorDescription())?db.getErrorSummary():db.getErrorDescription();this._handleSendMessageErrorCommon(db.getRequest(),fb,gb,{type:t.SERVER,code:db.getError(),description:ib,is_transient:db.isTransient()});},handleSendMessageTransportError:function(db){this._handleSendMessageErrorCommon(db.getRequest(),n.ERROR,'transport_error'+sa(db),{type:t.TRANSPORT,code:db.getError(),is_transient:true});},handleSendMessageTimeout:function(db){this._handleSendMessageErrorCommon(db,n.ERROR,'transport_timeout',{type:t.TIMEOUT,is_transient:true});},getLastActionTimestamp:function(){return this._lastActionTimestamp;},updateLastActionTimestamp:function(db){if(db)this._lastActionTimestamp=Math.max(this._lastActionTimestamp,db);},markThreadFetched:function(db){delete this._fetchingThreads[db];},_createServerErrorLogMessage:function(db){return {action_type:o.LOG_MESSAGE,thread_id:db,message_id:db,timestamp:Date.now(),timestamp_absolute:'',timestamp_relative:'',is_unread:false,source:ea.UNKNOWN,log_message_type:w.SERVER_ERROR,log_message_data:{}};},_getForAsyncRequest:function(db){var eb=db.getData(),fb=eb.request_user_id?eb.request_user_id:l.getID();return cb.getForFBID(fb);},__handleUpdate:function(db,eb){this._getForAsyncRequest(eb)._payloadPreprocessor.handleUpdate(db);},_handleThreadInfoError:function(db){var eb=this._getForAsyncRequest(db.getRequest());eb.handleThreadInfoError(db);},_handleSendMessageError:function(db){var eb=this._getForAsyncRequest(db.getRequest());eb.handleSendMessageError(db);},_handleSendMessageTransportError:function(db){var eb=this._getForAsyncRequest(db.getRequest());eb.handleSendMessageTransportError(db);},_handleSendMessageTimeout:function(db){var eb=this._getForAsyncRequest(db);eb.handleSendMessageTimeout(db);},_registerEndpoints:function(){var db=null;if(ba.msgrRegion)db={name:'X-MSGR-Region',value:ba.msgrRegion};var eb={'/ajax/mercury/thread_sync.php':{request_user_id:this._fbid,mode:ja.IDEMPOTENT,customHeader:db,handler:(function(fb,gb){return this.__handleUpdate(fb,gb);}).bind(this),connection_retries:3},'/ajax/mercury/thread_info.php':{request_user_id:this._fbid,mode:ja.BATCH_DEFERRED_MULTI,customHeader:db,batch_function:ta,handler:(function(fb,gb){return this.__handleUpdate(fb,gb);}).bind(this),error_handler:(function(fb){return this._handleThreadInfoError(fb);}).bind(this)},'/ajax/mercury/mark_folder_as_read.php':{request_user_id:this._fbid,mode:ja.IMMEDIATE,customHeader:db,handler:(function(fb,gb){return this.__handleUpdate(fb,gb);}).bind(this)},'/ajax/mercury/change_read_status.php':{request_user_id:this._fbid,mode:ja.BATCH_SUCCESSIVE,customHeader:db,batch_function:wa,handler:(function(fb,gb){return this.__handleUpdate(fb,gb);}).bind(this)},'/ajax/mercury/mark_seen.php':{request_user_id:this._fbid,mode:ja.BATCH_SUCCESSIVE,customHeader:db,batch_function:xa,handler:(function(fb,gb){return this.__handleUpdate(fb,gb);}).bind(this)},'/ajax/mercury/threadlist_info.php':{request_user_id:this._fbid,mode:ja.BATCH_SUCCESSIVE_UNIQUE,customHeader:db,batch_function:va,handler:(function(fb,gb){return this.__handleUpdate(fb,gb);}).bind(this)},'/ajax/mercury/mark_spam.php':{request_user_id:this._fbid,mode:ja.IMMEDIATE,customHeader:db,handler:(function(fb,gb){return this.__handleUpdate(fb,gb);}).bind(this)},'/ajax/mercury/unmark_spam.php':{request_user_id:this._fbid,mode:ja.IMMEDIATE,customHeader:db,handler:(function(fb,gb){return this.__handleUpdate(fb,gb);}).bind(this)},'/ajax/mercury/unread_threads.php':{request_user_id:this._fbid,mode:ja.BATCH_SUCCESSIVE_UNIQUE,customHeader:db,batch_function:ua,handler:(function(fb,gb){return this.__handleUpdate(fb,gb);}).bind(this)},'/ajax/chat/settings.php':{request_user_id:this._fbid,mode:ja.IMMEDIATE,customHeader:db},'/ajax/mercury/change_archived_status.php':{request_user_id:this._fbid,mode:ja.BATCH_SUCCESSIVE,customHeader:db,batch_function:za,handler:(function(fb,gb){return this.__handleUpdate(fb,gb);}).bind(this)},'/ajax/mercury/delete_thread.php':{request_user_id:this._fbid,mode:ja.BATCH_SUCCESSIVE,customHeader:db,batch_function:bb,handler:(function(fb,gb){return this.__handleUpdate(fb,gb);}).bind(this)},'/ajax/mercury/delete_messages.php':{request_user_id:this._fbid,mode:ja.IMMEDIATE,customHeader:db,handler:(function(fb,gb){return this.__handleUpdate(fb,gb);}).bind(this)},'/ajax/mercury/delivery_receipts.php':{request_user_id:this._fbid,mode:ja.IMMEDIATE,customHeader:db,handler:(function(fb,gb){return this.__handleUpdate(fb,gb);}).bind(this)},'/ajax/mercury/move_thread.php':{request_user_id:this._fbid,mode:ja.BATCH_SUCCESSIVE,customHeader:db,batch_function:ab,handler:(function(fb,gb){return this.__handleUpdate(fb,gb);}).bind(this)},'/ajax/mercury/change_mute_thread.php':{request_user_id:this._fbid,mode:ja.IMMEDIATE,customHeader:db,handler:(function(fb,gb){return this.__handleUpdate(fb,gb);}).bind(this)},'/mercury/pinned_threads/':{request_user_id:this._fbid,mode:ja.BATCH_SUCCESSIVE_UNIQUE,customHeader:db,handler:(function(fb,gb){return this.__handleUpdate(fb,gb);}).bind(this)},'/mercury/unpin_thread/':{request_user_id:this._fbid,mode:ja.IMMEDIATE,customHeader:db,handler:(function(fb,gb){return this.__handleUpdate(fb,gb);}).bind(this)}};ja.registerEndpoints(eb);},__sendRequest:function(db,eb,fb){ja.trySend(db,eb,fb,this._fbid);}});Object.assign(cb,da);f.exports=cb;},null);
__d('MercuryThreadIDMap',['KeyedCallbackManager','MercuryAssert','MercuryIDs','MercurySingletonProvider'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();function l(n){this.$MercuryThreadIDMap1=n;this.$MercuryThreadIDMap2=new h();this.$MercuryThreadIDMap3=new h();}l.getForFBID=function(n){return m.getForFBID(n);};l.get=function(){return m.get();};l.prototype.setServerIDToClientID=function(n,o){var p=this.getClientIDFromServerIDNow(n);if(p){p!==o;return;}this.forceSetServerIDToClientID(n,o);};l.prototype.forceSetServerIDToClientID=function(n,o){this.$MercuryThreadIDMap2.setResource(n,o);this.$MercuryThreadIDMap3.setResource(o,n);};l.prototype.setDeprecatedServerIDToClientID=function(n,o){if(n)this.$MercuryThreadIDMap2.setResource(n,o);};l.prototype.getClientIDFromServerIDNow=function(n){return this.$MercuryThreadIDMap2.getResource(n);};l.prototype.getClientIDFromServerID=function(n,o){this.$MercuryThreadIDMap2.executeOrEnqueue(n,o);e(['MercuryServerRequests'],(function(p){p.getForFBID(this.$MercuryThreadIDMap1).ensureThreadIsFetched(n);}).bind(this));};l.prototype.getServerIDFromClientIDNow=function(n){return this.$MercuryThreadIDMap3.getResource(n);};l.prototype.getServerIDFromClientID=function(n,o){i.isThreadID(n);var p=this.$MercuryThreadIDMap3.executeOrEnqueue(n,o);e(['MercuryServerRequests'],(function(q){var r=this.$MercuryThreadIDMap3.getUnavailableResources(p),s=j.tokenize(n);if(r.length&&s.type!='root')q.getForFBID(this.$MercuryThreadIDMap1).fetchThreadData(r);}).bind(this));};l.prototype.hasClientIDForServerID=function(n){return !!this.getClientIDFromServerIDNow(n);};l.prototype.convertThreadIDIfAvailable=function(n){var o=this.getClientIDFromServerIDNow(n);return o||n;};l.prototype.canLinkExternally=function(n){i.isThreadID(n);var o=j.tokenize(n);return o.type=='user'||!!this.getServerIDFromClientIDNow(n);};var m=new k(l);f.exports=l;},null);
__d('MercuryFolders',['MercuryConfig','MessagingTag','arrayContains'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=[i.INBOX,i.OTHER,i.ACTION_ARCHIVED,i.SPAM],l=[i.INBOX,i.PENDING,i.OTHER,i.ACTION_ARCHIVED],m={getSupportedFolders:function(){return h.CoreGraphEnabled?l.concat():k.concat();},isSupportedFolder:function(n){return j(k,n);},getFromMeta:function(n){var o=n.folder;if(n.is_archived)o=i.ACTION_ARCHIVED;return o;}};f.exports=m;},null);
__d('MercuryDisplayTimeFilterMessageRenderer',['fbt'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={renderFilteredContent:function(j){if(j.is_filtered_content_bh)return h._("\u0426\u0435 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f \u0432\u0438\u0434\u0430\u043b\u0435\u043d\u043e, \u0442\u043e\u043c\u0443 \u0449\u043e \u0432\u043e\u043d\u043e \u043c\u0456\u0441\u0442\u0438\u0442\u044c \u0437\u0430\u0431\u043b\u043e\u043a\u043e\u0432\u0430\u043d\u0456 \u0430\u0431\u043e \u0448\u043a\u0456\u0434\u043b\u0438\u0432\u0456 \u043f\u043e\u0441\u0438\u043b\u0430\u043d\u043d\u044f.");if(j.is_filtered_content_account)return h._("\u0426\u0435 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f \u0442\u0438\u043c\u0447\u0430\u0441\u043e\u0432\u043e \u0432\u0438\u0434\u0430\u043b\u0435\u043d\u043e, \u0442\u043e\u043c\u0443 \u0449\u043e \u043e\u0431\u043b\u0456\u043a\u043e\u0432\u0438\u0439 \u0437\u0430\u043f\u0438\u0441 \u0432\u0456\u0434\u043f\u0440\u0430\u0432\u043d\u0438\u043a\u0430 \u043f\u043e\u0442\u0440\u0435\u0431\u0443\u0454 \u043f\u0435\u0440\u0435\u0432\u0456\u0440\u043a\u0438.");if(j.is_filtered_content_quasar)return h._("\u0426\u0435 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f \u0432\u0438\u0434\u0430\u043b\u0435\u043d\u043e, \u0442\u043e\u043c\u0443 \u0449\u043e \u0432\u043e\u043d\u043e \u043c\u0456\u0441\u0442\u0438\u0442\u044c \u0437\u0430\u0431\u043b\u043e\u043a\u043e\u0432\u0430\u043d\u0438\u0439 \u0430\u0431\u043e \u0448\u043a\u0456\u0434\u043b\u0438\u0432\u0438\u0439 \u0432\u043c\u0456\u0441\u0442.");if(j.is_filtered_content_invalid_app)return h._("\u0426\u0435 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f \u0432\u0438\u0434\u0430\u043b\u0435\u043d\u043e, \u0442\u043e\u043c\u0443 \u0449\u043e \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f \u0432\u0456\u0434 \u0434\u043e\u0434\u0430\u0442\u043a\u0430, \u044f\u043a\u0438\u0439 \u043d\u0430\u0434\u0441\u0438\u043b\u0430\u0454 \u0439\u043e\u0433\u043e, \u0437\u0430\u0431\u043b\u043e\u043a\u043e\u0432\u0430\u043d\u043e.");return h._("\u0426\u0435 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f \u0442\u0438\u043c\u0447\u0430\u0441\u043e\u0432\u043e \u0432\u0438\u0434\u0430\u043b\u0435\u043d\u043e, \u0442\u043e\u043c\u0443 \u0449\u043e \u043e\u0431\u043b\u0456\u043a\u043e\u0432\u0438\u0439 \u0437\u0430\u043f\u0438\u0441 \u0432\u0456\u0434\u043f\u0440\u0430\u0432\u043d\u0438\u043a\u0430 \u043f\u043e\u0442\u0440\u0435\u0431\u0443\u0454 \u043f\u0435\u0440\u0435\u0432\u0456\u0440\u043a\u0438 \u0430\u0431\u043e \u0432\u043c\u0456\u0441\u0442 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f \u0432\u0438\u0437\u043d\u0430\u043d\u043e \u043e\u0431\u0440\u0430\u0437\u043b\u0438\u0432\u0438\u043c.");}};f.exports=i;},null);
__d('MercuryThreads',['EventEmitter','ImmutableObject','KeyedCallbackManager','LogHistory','Map','MercuryActionType','MercuryAPIArgsSource','MercuryAssert','MercuryAttachment','MercuryConfig','MercuryDispatcher','MercuryFolders','MercuryGlobalActionType','MercuryIDs','MercuryLogMessageType','MercuryLoggingHelper','MercuryPayloadSource','MercuryServerRequests','MercurySingletonProvider','MercuryThreadInfo','MercuryThreadInformer','MessagingTag','MercuryDisplayTimeFilterMessageRenderer','Set','emptyFunction','ifRequired','setImmediate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){'use strict';if(c.__markCompiled)c.__markCompiled();var ia=new h(),ja=k.getInstance('mercury_threads');function ka(ma){this.$MercuryThreads1=ma;this.$MercuryThreads2=y.getForFBID(this.$MercuryThreads1);this.$MercuryThreads3=ba.getForFBID(this.$MercuryThreads1);this.$MercuryThreads4=u.getParticipantIDFromUserID(this.$MercuryThreads1);this.$MercuryThreads5=r.getForFBID(this.$MercuryThreads1);this.$MercuryThreads6=false;this.$MercuryThreads7=new j();this.$MercuryThreads8=new ea();this.$MercuryThreads9=false;this.$MercuryThreads10=new ea();this.$MercuryThreads11=new ea();this.$MercuryThreads12();}ka.getForFBID=function(ma){return la.getForFBID(ma);};ka.get=function(){return la.get();};ka.prototype.getThreadMetaNow=function(ma){o.isThreadID(ma);return this.$MercuryThreads7.getResource(ma);};ka.prototype.getOrFetch=function(ma){var na=this.getThreadMetaNow(ma);if(!na&&!this.$MercuryThreads11.has(ma))this.$MercuryThreads10.add(ma);if(this.$MercuryThreads10.size>0&&!this.$MercuryThreads9)this.$MercuryThreads13();return na;};ka.prototype.$MercuryThreads13=function(){if(this.$MercuryThreads9)return;this.$MercuryThreads9=true;ha((function(){this.$MercuryThreads9=false;this.$MercuryThreads10.forEach((function(ma){return this.$MercuryThreads11.add(ma);}).bind(this));this.getMultiThreadMeta(Array.from(this.$MercuryThreads10),(function(ma){for(var na in ma)ma.hasOwnProperty(na)&&this.$MercuryThreads11['delete'](na);}).bind(this));this.$MercuryThreads10.clear();}).bind(this));};ka.prototype.getThreadMeta=function(ma,na,oa){return this.getMultiThreadMeta([ma],function(pa){return na(pa[ma]);},oa);};ka.prototype.getMultiThreadMeta=function(ma,na,oa){o.allThreadID(ma);var pa=this.$MercuryThreads7.executeOrEnqueue(ma,na),qa=this.$MercuryThreads7.getUnavailableResources(pa);if(qa.length){var ra=[];for(var sa=0;sa<qa.length;sa++){var ta=qa[sa],ua=u.tokenize(ta),va=ua.type,wa=ua.value;if(va=='user'){var xa=u.getParticipantIDFromUserID(wa);this.createNewLocalThread(ta,xa===this.$MercuryThreads4?[this.$MercuryThreads4]:[this.$MercuryThreads4,xa]);}else ra.push(ta);}if(ra.length)this.$MercuryThreads2.fetchThreadData(ra,oa);}return pa;};ka.addListener=function(ma,na){return ia.addListener(ma,na);};ka.prototype.unsubscribe=function(ma){this.$MercuryThreads7.unsubscribe(ma);};ka.prototype.getCanonicalThreadToParticipant=function(ma,na,oa,pa){var qa=u.getThreadIDFromParticipantID(ma),ra=this.$MercuryThreads7.getResource(qa);if(typeof ra=='undefined'){ra=this.createNewLocalThread(qa,this.$MercuryThreads4===ma?[this.$MercuryThreads4]:[this.$MercuryThreads4,ma],na);!pa&&this.$MercuryThreads2.fetchThreadData([qa],oa);}return ra;};ka.prototype.createNewLocalThread=function(ma,na,oa){var pa=this.$MercuryThreads7.getResource(ma);if(!pa){var qa=u.tokenize(ma),ra=qa.type,sa=qa.value;pa=new i({thread_id:ma,participants:Array.from(na),name:'',snippet:'',snippet_has_attachment:false,snippet_sender:null,unread_count:oa?oa:0,message_count:0,image_src:null,timestamp_absolute:null,timestamp_relative:null,timestamp:null,other_user_fbid:ra==='user'?sa:null,is_canonical_user:ra=='user',is_canonical:this.$MercuryThreads14(na),is_subscribed:true,folder:ca.INBOX,is_archived:false});this.$MercuryThreads7.setResource(ma,pa);}return pa;};ka.prototype.isEmptyLocalThread=function(ma){var na=this.$MercuryThreads7.getResource(ma);if(!na)return false;return aa.isEmptyLocalThread(na);};ka.prototype.isNewEmptyLocalThread=function(ma){var na=this.$MercuryThreads7.getResource(ma);if(!na)return false;return aa.isNewEmptyLocalThread(na);};ka.prototype.$MercuryThreads15=function(ma,na){if(!ma||!ma.length)return;var oa=new l(),pa=new l(),qa=new l(),ra=[];for(var sa=0;sa<ma.length;sa++){var ta=ma[sa];if(ta.is_forward)continue;var ua=ta.action_type;if(ua==m.LOG_MESSAGE&&ta.log_message_type==v.SERVER_ERROR)continue;var va=!!(ta.sync_id||ta.action_id||ta.is_from_iris),wa=ta.thread_id;o.isThreadID(wa);var xa=this.$MercuryThreads7.getResource(wa);if(!xa&&!va&&ua==m.USER_GENERATED_MESSAGE){xa=this.$MercuryThreads16(ta);this.$MercuryThreads7.setResource(wa,xa);}if(!xa)continue;if(ua==m.LOG_MESSAGE||ua==m.USER_GENERATED_MESSAGE)va=!na;if(xa.server_timestamp&&ta.timestamp<=xa.server_timestamp&&va)continue;if(!qa.has(wa))qa.set(wa,babelHelpers._extends({},xa));this.$MercuryThreads17(qa.get(wa),ta,na);if(ua==m.USER_GENERATED_MESSAGE)oa.set(wa,ta);if(ua==m.USER_GENERATED_MESSAGE||ua==m.LOG_MESSAGE||ua==m.SEND_MESSAGE)if(ta&&ta.timestamp&&(!pa.has(wa)||ta.timestamp>pa.get(wa).timestamp))pa.set(wa,ta);}qa.forEach((function(ya,za){var ab=pa.get(za),bb=oa.get(za);if(bb){this.$MercuryThreads18(ya,bb);}else if(ab&&(ab.log_message_type==v.PHONE_CALL||ab.log_message_type==v.VIDEO_CALL)){var cb=babelHelpers._extends({},ab,{body:ab.log_message_body});this.$MercuryThreads18(ya,cb);}var db=ya.timestamp;if(ab){if(ab.timestamp>db)Object.assign(ya,{timestamp_absolute:ab.timestamp_absolute,timestamp_relative:ab.timestamp_relative,timestamp:ab.timestamp});var eb=ya.server_timestamp;if(!na&&ab.timestamp>eb)ya.server_timestamp=ab.timestamp;}var fb=new i(ya);this.$MercuryThreads7.setResource(za,fb);ra.push(w.obfuscateThread(fb));}).bind(this),this);ra.length&&this.$MercuryThreads6&&ja.debug('threads_updated',{threads:ra});};ka.prototype.$MercuryThreads17=function(ma,na,oa){var pa=na.action_type;if(pa==m.USER_GENERATED_MESSAGE||pa==m.LOG_MESSAGE){na.is_unread&&ma.unread_count++;ma.message_count++;ma.is_archived=false;}switch(pa){case m.DELETE_THREAD:ma.message_count=0;this.$MercuryThreads19(na.thread_id);break;case m.USER_GENERATED_MESSAGE:if(ma.last_read_timestamp>=na.timestamp)this.$MercuryThreads20(ma,na,true);if(ma.unread_count===0&&na.author===this.$MercuryThreads4&&na.timestamp>=ma.last_read_timestamp)ma.last_read_timestamp=na.timestamp;if(na.offline_threading_id!==na.message_id){ma.last_message_id=na.message_id;ma.last_message_timestamp=na.timestamp;}this.$MercuryThreads21(ma,na.author);break;case m.SEND_MESSAGE:var qa=na.log_message_type;if(qa==v.THREAD_IMAGE){ma.image_src=na.log_message_data.image?na.log_message_data.image.preview_url:null;this.$MercuryThreads22(na.thread_id);}if(qa!==v.SUBSCRIBE&&qa!==v.UNSUBSCRIBE)ma.snippet_attachments=na.attachments;break;case m.LOG_MESSAGE:var qa=na.log_message_type;if(qa==v.SUBSCRIBE){this.$MercuryThreads23(ma,na.log_message_data.added_participants);this.$MercuryThreads22(na.thread_id);}else if(qa==v.UNSUBSCRIBE){this.$MercuryThreads24(ma,na.log_message_data.removed_participants);this.$MercuryThreads22(na.thread_id);}else if(qa==v.THREAD_IMAGE){if(!oa)ma.image_src=na.log_message_data.image?na.log_message_data.image.preview_url:null;}else if(qa==v.THREAD_NAME){if(ma.name!==na.log_message_data.name)this.$MercuryThreads22(na.thread_id);ma.name=na.log_message_data.name;}else if(qa===v.GENERIC_ADMIN_TEXT)if(this.$MercuryThreads25(ma,na))this.$MercuryThreads22(na.thread_id);break;case m.CHANGE_READ_STATUS:var ra=this.$MercuryThreads20(ma,na,na.mark_as_read);if(ra)ma.last_read_timestamp=ma.last_message_timestamp;var sa=!ma.read_only&&ma.folder===ca.INBOX;if(ra&&oa)this.$MercuryThreads2.changeThreadReadStatus(ma.thread_id,na.mark_as_read,na.source,ma.last_read_timestamp,ma.titan_originated_thread_id,sa);break;case m.CHANGE_ARCHIVED_STATUS:if(ma.is_archived!=na.archived){ma.is_archived=na.archived;this.$MercuryThreads22(na.thread_id);}break;case m.CHANGE_FOLDER:if(ma.folder!=na.new_folder){ma.folder=na.new_folder;this.$MercuryThreads22(na.thread_id);}break;case m.DELETE_MESSAGES:if(oa){ma.snippet='...';ma.snippet_has_attachment=false;ma.snippet_attachments=null;ma.snippet_sender=null;this.$MercuryThreads22(na.thread_id);}else if(na.message_ids){ma.message_count-=na.message_ids.length;ga('MercuryMessages',(function(va){va=va.getForFBID(this.$MercuryThreads1);for(var wa=na.message_ids,xa=Array.isArray(wa),ya=0,wa=xa?wa:wa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var za;if(xa){if(ya>=wa.length)break;za=wa[ya++];}else{ya=wa.next();if(ya.done)break;za=ya.value;}var ab=za,bb=va.getMessagesFromIDs([ab]),cb=bb[0];if(cb&&cb.timestamp>ma.last_read_timestamp)ma.unread_count=Math.max(0,ma.unread_count-1);}this.$MercuryThreads22(na.thread_id);}).bind(this),fa);}break;case m.UPDATE_SNIPPET:ga('MercuryMessages',(function(va){va=va.getForFBID(this.$MercuryThreads1);var wa=false;for(var xa=na.deleted_ids,ya=Array.isArray(xa),za=0,xa=ya?xa:xa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ab;if(ya){if(za>=xa.length)break;ab=xa[za++];}else{za=xa.next();if(za.done)break;ab=za.value;}var bb=ab;if(bb==ma.last_message_id){wa=true;break;}}if(!wa)return;var cb=0,db=1,eb=va.getThreadMessagesRangeNow(na.thread_id,cb,db),fb=eb[0];if(fb){ma.snippet=fb.body;ma.snippet_has_attachment=fb.has_attachment;ma.snippet_attachments=fb.attachments;ma.snippet_sender=fb.author;ma.last_message_id=va.getServerMessageID(fb.message_id);}else{ma.snippet='...';ma.snippet_has_attachment=false;ma.snippet_attachments=null;ma.snippet_sender=null;va.getThreadMessagesRange(na.thread_id,cb,db,(function(gb){if(gb.length)this.$MercuryThreads5.handleUpdate({from_client:true,actions:[{thread_id:na.thread_id,action_type:m.UPDATE_SNIPPET,deleted_ids:na.deleted_ids}]});}).bind(this));}this.$MercuryThreads22(na.thread_id);}).bind(this),fa);break;case m.UPDATE_BLOCKER_STATUS:ma.can_reply=!!(!na.message_blocked&&(na.is_blocked_by_recipient===undefined||!na.is_blocked_by_recipient)&&ma.is_subscribed&&!ma.has_email_participant&&!ma.read_only&&(ma.recipients_loadable||ma.recipients_loadable===undefined));this.$MercuryThreads22(na.thread_id);break;case m.UPDATE_BLOCKEE_STATUS:ma.can_reply=!!(!na.got_blocked&&ma.is_subscribed&&!ma.has_email_participant&&!ma.read_only&&(ma.recipients_loadable||ma.recipients_loadable===undefined));this.$MercuryThreads22(na.thread_id);break;case m.CHANGE_MUTE_SETTINGS:if(na.mute_settings!==undefined){var ta=this.$MercuryThreads1+'@facebook.com';if(ma.mute_settings){if(na.mute_settings){var ua={};ua[ta]=na.mute_settings;ma.mute_settings=babelHelpers._extends({},ma.mute_settings,ua);}else{ma.mute_settings=babelHelpers._extends({},ma.mute_settings);delete ma.mute_settings[ta];}this.$MercuryThreads22(ma.thread_id);}}break;case m.ADD_PARTICIPANTS:this.$MercuryThreads23(ma,na.participants);this.$MercuryThreads22(ma.thread_id);break;case m.CHANGE_FLAG:this.$MercuryThreads26(ma,na.mark_as_flag);this.$MercuryThreads22(ma.thread_id);break;case m.MOVE_PENDING_TO_INBOX:this.$MercuryThreads27(ma);this.$MercuryThreads22(ma.thread_id);break;}};ka.prototype.$MercuryThreads16=function(ma){var na=u.tokenize(ma.thread_id),oa=na.type,pa=na.value,qa=this.$MercuryThreads14(ma.specific_to_list);return new i({thread_id:ma.thread_id,participants:ma.specific_to_list,name:null,snippet:ma.body,snippet_has_attachment:false,snippet_attachments:[],snippet_sender:ma.author,unread_count:0,message_count:0,image_src:null,timestamp_absolute:ma.timestamp_absolute,timestamp_relative:ma.timestamp_relative,timestamp:ma.timestamp,other_user_fbid:oa==='user'?pa:null,is_canonical_user:oa==='user',is_canonical:qa,is_subscribed:true,folder:ca.INBOX,is_archived:false});};ka.prototype.$MercuryThreads20=function(ma,na,oa){if(na.timestamp)this.$MercuryThreads28(ma.thread_id,oa,na.timestamp);if(!ma||!ma.thread_id)return false;if(!ma.timestamp){this.$MercuryThreads8.add(ma.thread_id);return false;}var pa=!ma.unread_count;if(oa==pa)return false;ma.unread_count=oa?0:1;this.$MercuryThreads22(ma.thread_id);return true;};ka.prototype.$MercuryThreads29=function(ma){var na=this.$MercuryThreads7.getAllResources();for(var oa in na)if(na.hasOwnProperty(oa)){var pa=na[oa];if(pa.folder==ma){this.$MercuryThreads7.setResource(oa,i.setProperty(pa,'unread_count',0));this.$MercuryThreads22(oa);}}};ka.prototype.$MercuryThreads23=function(ma,na){var oa=new ea(ma.participants);ma.participants=Array.from(ma.participants);na.forEach((function(pa){if(!oa.has(pa)){ma.participants.push(pa);if(pa===this.$MercuryThreads4){ma.is_subscribed=true;ma.can_reply=true;ma.composer_enabled=true;this.$MercuryThreads2.fetchMissedMessages(s.getSupportedFolders(),n.MERCURYSYNC,ma.last_message_timestamp);}}}).bind(this));};ka.prototype.$MercuryThreads25=function(ma,na){if(na.log_message_data&&na.log_message_data.untypedData){var oa=parseInt(na.log_message_data.untypedData.ttl,10);if(oa!==null&&ma.ephemeral_ttl_mode!==oa){ma.ephemeral_ttl_mode=oa;return true;}}return false;};ka.prototype.$MercuryThreads24=function(ma,na){var oa=new ea(na);ma.participants=ma.participants.filter(function(pa){return !oa.has(pa);});if(oa.has(this.$MercuryThreads4))ma.is_subscribed=false;this.$MercuryThreads2.fetchThreadData([ma.thread_id]);};ka.prototype.$MercuryThreads21=function(ma,na){var oa=ma.participants.indexOf(na);if(oa>0)ma.participants=[na].concat(ma.participants.slice(0,oa),ma.participants.slice(oa+1));};ka.prototype.$MercuryThreads18=function(ma,na){var oa=na.body,pa=na.subject,qa='';if(pa){pa=pa.toLowerCase();if(oa.slice(0,pa.length).toLowerCase()==pa){qa=oa;}else if(oa){qa=pa+' \u00B7 '+oa;}else qa=pa;}else qa=oa;if(na.is_filtered_content)qa=da.renderFilteredContent(na);ma.snippet=qa;ma.snippet_has_attachment=na.has_attachment;if(na.raw_attachments&&na.raw_attachments.length>0){var ra=p.convertRaw(na.raw_attachments);ma.snippet_attachments=ra;}else ma.snippet_attachments=na.attachments;ma.snippet_sender=na.author;};ka.prototype.$MercuryThreads26=function(ma,na){ma.page_thread_info=babelHelpers._extends({},ma.page_thread_info,{flagged:na});};ka.prototype.$MercuryThreads27=function(ma){if(ma.folder!==ca.PENDING)return;ma.folder=ca.INBOX;};ka.prototype.$MercuryThreads14=function(ma){return ma.filter((function(na){return na!=this.$MercuryThreads4;}).bind(this)).length<=1;};ka.prototype.$MercuryThreads12=function(){this.$MercuryThreads5.subscribe('invalidate-thread-state',(function(ma,na){return this.$MercuryThreads30(na);}).bind(this));this.$MercuryThreads5.subscribe('update-threads',(function(ma,na){var oa=(na.actions||[]).filter(function(pa){return pa.thread_id;});if(na.threads&&na.payload_source==x.SERVER_FETCH_THREAD_INFO)na.threads.forEach((function(pa){var qa=pa.thread_id;if(this.$MercuryThreads8.has(qa)){this.$MercuryThreads8['delete'](qa);if(pa.unread_count)this.$MercuryThreads2.changeThreadReadStatus(pa.thread_id,true);}}).bind(this));this.$MercuryThreads31(na.threads);this.$MercuryThreads15(oa,na.from_client);na.threads&&na.threads.forEach((function(pa){this.$MercuryThreads22(pa.thread_id);}).bind(this));if(na.global_actions)na.global_actions.forEach((function(pa){if(pa.action_type==t.MARK_ALL_READ)this.$MercuryThreads29(pa.folder);}).bind(this));if(this.$MercuryThreads6){this.$MercuryThreads6=false;ia.emit('change');}}).bind(this));};ka.prototype.$MercuryThreads31=function(ma){if(!ma||!ma.length)return;var na={},oa=[];ma.forEach(function(pa){var qa=new i(pa);na[pa.thread_id]=qa;oa.push(w.obfuscateThread(qa));});oa.length&&ja.debug('threads_added',{threads:oa});this.$MercuryThreads7.addResourcesAndExecute(na);};ka.prototype.$MercuryThreads22=function(ma){this.$MercuryThreads6=true;this.$MercuryThreads3.updatedThread(ma);};ka.prototype.$MercuryThreads19=function(ma){this.$MercuryThreads6=true;this.$MercuryThreads3.deletedThread(ma);};ka.prototype.$MercuryThreads28=function(ma,na,oa){this.$MercuryThreads6=true;this.$MercuryThreads3.changedThreadReadState(ma,na,oa);};ka.prototype.$MercuryThreads30=function(ma){this.$MercuryThreads7.setResource(ma,undefined);};var la=new z(ka);f.exports=ka;},null);
__d('MercuryUnreadState',['MercuryFolders','LogHistory','KeyedCallbackManager','MercuryActionType','MercuryDispatcher','MercuryGlobalActionType','MercurySingletonMixin','MercuryThreadlistConstants','MercuryThreadIDMap','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','arrayContains','createObjectFrom'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=(h.getSupportedFolders()||[]).filter(function(oa){return oa!=q.ACTION_ARCHIVED;}),x='unread_thread_hash',y='unseen_thread_list',z=o.MAX_UNREAD_COUNT,aa=i.getInstance('mercury_unread_state');function ba(oa){this._fbid=oa;this._serverRequests=r.getForFBID(this._fbid);this._threadIDMap=p.getForFBID(this._fbid);this._threadInformer=s.getForFBID(this._fbid);this._threads=t.getForFBID(this._fbid);this._dispatcher=l.getForFBID(this._fbid);this._allReadTimestamp={};this._threadReadTimestamp={};this._initialUnreadCount={};this._maxCount={};this._unreadResources={};w.forEach((function(pa){this._initialUnreadCount[pa]=0;this._maxCount[pa]=false;this._unreadResources[pa]=new j();}).bind(this));this._dispatcher.subscribe('update-unread',(function(pa,qa){ga(this,qa);var ra=qa.global_actions||[];for(var sa=0;sa<ra.length;sa++){var ta=ra[sa];if(ta.action_type==m.MARK_ALL_READ)ja(this,ta.folder,ta.timestamp);}}).bind(this));this._dispatcher.subscribe('update-thread-ids',(function(pa,qa){la(this,qa);}).bind(this));}Object.assign(ba.prototype,{getUnreadCount:function(oa){if(this.exceedsMaxCount(oa)){aa.error('unguarded_unread_count_fetch',{});return 0;}return fa(this,oa);},exceedsMaxCount:function(oa){return this._maxCount[oa]||fa(this,oa)>z;},markFolderAsRead:function(oa){if(this._maxCount[oa]||fa(this,oa)>0)this._serverRequests.markFolderAsRead(oa);},getIsThreadUnread:function(oa,pa){var qa=pa||q.INBOX,ra=ea(this,qa);return ra&&ra[oa];}});Object.assign(ba,n);function ca(oa,pa,qa){oa._unreadResources[pa].setResource(x,qa);oa._unreadResources[pa].setResource(y,Object.keys(qa));}function da(oa,pa,qa){var ra=oa._unreadResources[pa].executeOrEnqueue(x,qa),sa=oa._unreadResources[pa].getUnavailableResources(ra);if(sa.length)oa._serverRequests.fetchUnreadThreadIDs(pa);}function ea(oa,pa){return oa._unreadResources[pa].getResource(x);}function fa(oa,pa){var qa=oa._unreadResources[pa].getResource(y);if(qa){return qa.length;}else return oa._initialUnreadCount[pa];}function ga(oa,pa){var qa;(pa.unread_thread_fbids||[]).forEach(function(ra){qa=ra.folder;if(!na(qa))return;var sa=ra.thread_fbids||[];sa=sa.concat(ra.other_user_fbids||[]);var ta=ka(oa,sa);ca(oa,qa,v(ta,true));if(ta.length>z)oa._maxCount[qa]=true;oa._threadInformer.updatedUnreadState();});(pa.message_counts||[]).forEach(function(ra){if(ra.unread_count===undefined)return;qa=ra.folder;if(ra.unread_count>z){oa._maxCount[qa]=true;ca(oa,qa,{});oa._threadInformer.updatedUnreadState();}else{oa._initialUnreadCount[qa]=ra.unread_count;if(oa._initialUnreadCount[qa]===0)ca(oa,qa,{});oa._threadInformer.updatedUnreadState();}});(pa.actions||[]).forEach(function(ra){if(ra.is_forward)return;var sa=k,ta=ra.other_user_fbid?ra.other_user_fbid:ra.thread_fbid,ua=ra.thread_id?ra.thread_id:ta;if(ra.action_type==sa.DELETE_THREAD){w.forEach(function(wa){ia(oa,wa,ua);});}else if(ra.action_type==sa.CHANGE_ARCHIVED_STATUS||ra.action_type==sa.CHANGE_FOLDER){var va=oa._threads.getThreadMetaNow(ra.thread_id);qa=h.getFromMeta(va);if(na(qa)&&va.unread_count>0)ha(oa,qa,ua);w.forEach(function(wa){if(wa!=qa)ia(oa,wa,ua);});}else{qa=ma(oa,ra);if(!na(qa))return;if(ra.action_type==sa.CHANGE_READ_STATUS){if(ra.mark_as_read){ia(oa,qa,ua,ra.timestamp);}else ha(oa,qa,ua,ra.timestamp);}else if(ra.action_type==sa.USER_GENERATED_MESSAGE||ra.action_type==sa.LOG_MESSAGE)if(ra.is_unread)ha(oa,qa,ua,ra.timestamp);}});}function ha(oa,pa,qa,ra){if(oa._maxCount[pa])return;da(oa,pa,function(sa){var ta=oa._allReadTimestamp[pa]||0,ua=oa._threadReadTimestamp[qa]||0,va=ra||Number.POSITIVE_INFINITY;if(va>=ta&&va>=ua&&!sa[qa]){sa[qa]=ra||0;ca(oa,pa,sa);oa._threadInformer.updatedUnreadState();}});}function ia(oa,pa,qa,ra){if(oa._maxCount[pa])return;da(oa,pa,function(sa){if(ra){var ta=oa._threadReadTimestamp[qa];if(!ta||ta<ra)oa._threadReadTimestamp[qa]=ra;}var ua=sa[qa];if(ra&&typeof ua=='number'&&ra<ua)return;if(qa in sa){delete sa[qa];ca(oa,pa,sa);oa._threadInformer.updatedUnreadState();}});}function ja(oa,pa,qa){oa._maxCount[pa]=false;ca(oa,pa,{});oa._allReadTimestamp[pa]=Math.max(oa._allReadTimestamp[pa]||0,qa||0);oa._threadInformer.updatedUnreadState();}function ka(oa,pa){return pa.map(oa._threadIDMap.convertThreadIDIfAvailable,oa._threadIDMap);}function la(oa,pa){w.forEach(function(qa){var ra=ea(oa,qa);if(!ra)return;for(var sa in pa){var ta=pa[sa];if(ra[sa]){ra[ta]=ra[sa];delete ra[sa];}}ca(oa,qa,ra);});}function ma(oa,pa){var qa=pa.thread_id?oa._threads.getThreadMetaNow(pa.thread_id):null;return qa?h.getFromMeta(qa):pa.folder;}function na(oa){return u(w,oa);}f.exports=ba;},null);
__d('MercuryFilters',['MessagingTag','arrayContains'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=[h.UNREAD],k={ALL:'all',UNREAD:h.UNREAD,getSupportedFilters:function(){return j.concat();},isSupportedFilter:function(l){return i(j,l);}};f.exports=k;},null);
__d('MercuryLocalIDs',['PresenceUtil','randomInt'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j={generateMessageID:function(l){var m=l||Date.now(),n=i(0,4294967295),o=h.getSessionID();return '<'+m+':'+n+'-'+o+'@mail.projektitan.com>';},generateThreadID:function(l){return 'root:'+j.generateOfflineThreadingID(l);},generateOfflineThreadingID:function(l){var m=l||Date.now(),n=i(0,4294967295),o=('0000000000000000000000'+n.toString(2)).slice(-22),p=m.toString(2)+o;return k(p.slice(-63));}};function k(l){var m='';while(l!='0'){var n=0,o='';for(var p=0;p<l.length;p++){n=2*n+parseInt(l[p],10);if(n>=10){o+='1';n-=10;}else o+='0';}m=n.toString()+m;l=o.slice(o.indexOf('1'));}return m;}f.exports=j;},null);
__d('MercuryViewer',['CurrentUser','MercuryAssert'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j='fbid:'+h.getID(),k={getID:function(){return j;},isViewer:function(l){i.isParticipantID(l);return l===j;}};f.exports=k;},null);
__d('SoundPlayer',['Arbiter','Flash','URI','createArrayFromMixed'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l={},m=null,n=false,o='so_sound_player',p='/swf/SoundPlayer.swf?v=1',q=null,r={};function s(ca){var da=new j(ca);if(!da.getDomain())return new j(window.location.href).setPath(da.getPath()).toString();return ca;}function t(ca){var da=new j(ca).getPath();if(/\.mp3$/.test(da))return 'audio/mpeg';if(/\.og[ga]$/.test(da))return 'audio/ogg';return '';}function u(){if(!q){var ca=document.createElement('audio');if(!ca||!ca.canPlayType)return null;ca.setAttribute('preload','auto');document.body.appendChild(ca);q=ca;}return q;}function v(ca){return r[ca];}function w(ca,da){r[ca]=da;}function x(){var ca=document[o]||window[o];if(ca)if(!ca.playSound&&ca.length)ca=ca[0];return ca&&ca.playSound&&ca.loopSound?ca:null;}function y(){return n;}function z(ca,da,ea){m={path:ca,sync:da,loop:ea};}function aa(){n=true;if(m){var ca=x();if(m.loop){ca.loopSound(m.path,m.sync);}else ca.playSound(m.path,m.sync);}}var ba={init:function(ca){ca=k(ca);var da;for(var ea=0;ea<ca.length;++ea){da=ca[ea];if(l[da])return;}var fa=u();for(ea=0;fa&&ea<ca.length;++ea){da=ca[ea];if(fa.canPlayType(da)){l[da]=true;return;}}l['audio/mpeg']=true;if(x())return;try{h.registerCallback(aa,['sound/player_ready','sound/ready']);var ha=document.createElement('div');ha.id='sound_player_holder';document.body.appendChild(ha);var ia=window[o]=i.embed(p,ha,{allowscriptaccess:'always',wmode:'transparent'},{swf_id:o});ia.setAttribute('id',o);ia.setAttribute('width','1px');ia.setAttribute('height','1px');h.inform('sound/player_ready');}catch(ga){}},createAndPlayNewNative:function(ca,da){var ea=document.createElement('audio');ea.setAttribute('preload','auto');document.body.appendChild(ea);ea.src=s(ca);if(da){ea.setAttribute('loop','');}else ea.removeAttribute('loop');ea.play();w(ca,ea);return;},play:function(ca,da){ca=k(ca);var ea=u(),fa,ga;for(var ha=0;ea&&ha<ca.length;++ha){fa=ca[ha];var ia=v(fa);if(ia){if(da){ia.setAttribute('loop','');}else ia.removeAttribute('loop');ia.play();return;}ga=t(fa);if(!ea.canPlayType(ga))continue;ba.init([ga]);ba.createAndPlayNewNative(fa,da);return;}for(ha=0;ha<ca.length;++ha){fa=s(ca[ha]);ga=t(fa);if(ga!='audio/mpeg')continue;ba.init([ga]);var ja=x();if(!y()){z(fa,true,da);return;}else if(ja){if(da){ja.loopSound(fa,true);}else ja.playSound(fa,true);return;}}},stop:function(ca){ca=k(ca);for(var da=0;da<ca.length;++da){var ea=s(ca[da]),fa=v(ca[da]),ga=x();if(fa&&fa.src==ea){fa.pause();fa.removeAttribute('src');fa.src=ea;}else ga&&ga.stopSound(ea);}}};f.exports=ba;},null);
__d('SoundSynchronizer',['SoundPlayer','WebStorage','createArrayFromMixed'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k='fb_sounds_playing3';function l(){var p=i.getLocalStorage();if(p)try{var r=p[k];if(r){r=JSON.parse(r);if(Array.isArray(r))return r;}}catch(q){}return [];}function m(p){var q=i.getLocalStorage();if(q){var r=l();r.push(p);while(r.length>5)r.shift();try{q[k]=JSON.stringify(r);}catch(s){}}}function n(p){return l().some(function(q){return q===p;});}var o={play:function(p,q,r){p=j(p);q=q||p[0]+Math.floor(Date.now()/1000);if(n(q))return;h.play(p,r);m(q);},isSupported:function(){return !!i.getLocalStorage();}};f.exports=o;},null);
__d('SoundRPC',['Event','FBJSON','SoundSynchronizer'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(m,n,o){j.play(m,n,o);}var l={playLocal:k,playRemote:function(m,n,o,p){var q={name:'SoundRPC',data:{paths:n,sync:o,loop:p}};m.postMessage(i.stringify(q),'*');},supportsRPC:function(){return !!window.postMessage;},_listen:function(){h.listen(window,'message',function(m){if(!/\.facebook.com$/.test(m.origin))return;var n={};try{n=i.parse(m.data);}catch(o){}if(n.name==='SoundRPC')k(n.data.paths,n.data.sync,n.data.loop);});}};f.exports=l;},null);
__d('P2PDispatcher',['Dispatcher'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new h();},null);